<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.2">Jekyll</generator><link href="http://rust.love/feed.xml" rel="self" type="application/atom+xml" /><link href="http://rust.love/" rel="alternate" type="text/html" /><updated>2018-02-21T15:32:18+08:00</updated><id>http://rust.love/</id><title type="html">Rust.Love</title><subtitle>Freedom &amp; Responsibility.</subtitle><entry><title type="html">æ¶æ„æ‹†è§£ä¹‹ä»€ä¹ˆæ˜¯ CDCï¼ˆä¸€å‘¨å­¦ä¹ æŠ¥-ç¬¬2æœŸï¼‰</title><link href="http://rust.love/cdc/mysql/arch/2018/02/09/cdc.html" rel="alternate" type="text/html" title="æ¶æ„æ‹†è§£ä¹‹ä»€ä¹ˆæ˜¯ CDCï¼ˆä¸€å‘¨å­¦ä¹ æŠ¥-ç¬¬2æœŸï¼‰" /><published>2018-02-09T00:00:00+08:00</published><updated>2018-02-09T00:00:00+08:00</updated><id>http://rust.love/cdc/mysql/arch/2018/02/09/cdc</id><content type="html" xml:base="http://rust.love/cdc/mysql/arch/2018/02/09/cdc.html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;èƒŒæ™¯&lt;/h2&gt;

&lt;p&gt;åœ¨æˆ‘ä»¬çš„æ•´ä¸ªæ¶æ„ä½“ç³»ä¸­ï¼Œæˆ‘ä»¬å¤§é‡çš„ä½¿ç”¨äº† CDCï¼Œå¾ˆå¤šåŒå­¦å¼€å§‹ä¸å¤ªæ¸…æ¥šï¼Œä¸çŸ¥é“ CDC æ˜¯ä»€ä¹ˆï¼Œä»¥ä¸º CDC æ˜¯ä¸€ä¸ªå…·ä½“çš„è½¯ä»¶ï¼Œå…¶å® CDC æ˜¯ä¸€ä¸ªç»Ÿç§°ï¼Œå°±åƒ Office ä»£è¡¨çš„æ˜¯ä¸€ç»„åŠå…¬è½¯ä»¶ï¼Œè€Œ CDC ä¹Ÿæ˜¯å„ç§ä¸åŒåå­—å…·æœ‰ CDC åŠŸèƒ½çš„è½¯ä»¶çš„ç»Ÿç§°ï¼Œæ‰€ä»¥ç®€å•ä»‹ç»ä¸‹å…³äº CDC çš„å†…å®¹ã€‚æ–‡ä¸­ CDC ä¸»è¦æ˜¯å’Œæ•°æ®åº“ã€MySQL ç›¸å…³çš„å†…å®¹ï¼Œå¹¶ä¸å…·æœ‰å¹¿æ³›çš„æ„ä¹‰ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æœ¬æœŸç›®æ ‡&quot;&gt;æœ¬æœŸç›®æ ‡&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;äº†è§£ä»€ä¹ˆæ˜¯ CDC&lt;/li&gt;
  &lt;li&gt;å„ç§ CDC&lt;/li&gt;
  &lt;li&gt;CDC çš„ä¸€äº›ä½¿ç”¨åœºæ™¯å’Œä¸€äº›æƒ³è±¡&lt;/li&gt;
  &lt;li&gt;å¦‚ä½•è‡ªå·±å®ç°ä¸€ä¸ª CDC è½¯ä»¶&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ä»€ä¹ˆæ˜¯-cdc&quot;&gt;ä»€ä¹ˆæ˜¯ CDC&lt;/h3&gt;

&lt;p&gt;CDC å…¨ç§° Change Data Captureï¼Œä¸‹é¢æ˜¯æ¥è‡ª&lt;a href=&quot;https://en.wikipedia.org/wiki/Change_data_capture&quot;&gt;ç»´åŸºç™¾ç§‘&lt;/a&gt;çš„ä¸€æ®µè¯´æ˜ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;In databases, change data capture (CDC) is a set of software design patterns used to determine (and track) the data that has changed so that action can be taken using the changed data. Also, Change data capture (CDC) is an approach to data integration that is based on the identification, capture and delivery of the changes made to enterprise data sources.
CDC solutions occur most often in data-warehouse environments since capturing and preserving the state of data across time is one of the core functions of a data warehouse, but CDC can be utilized in any database or data repository system.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç®€å•æ¥è¯´ CDC å°±æ˜¯è®°å½•æ•°æ®å˜åŒ–çš„ä¸€ä¸ªå·¥å…·è½¯ä»¶ï¼Œå®ƒå¯ä»¥æ•æ‰æ¯ä¸€æ¬¡çš„æ•°æ®å˜åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é˜¿é‡Œå¼€æºçš„ &lt;a href=&quot;https://github.com/alibaba/canal&quot;&gt;canal&lt;/a&gt;ï¼Œçœ‹ä¸‹ä¸‹é¢çš„è¿™ä¸ªå›¾ï¼ˆæ¥è‡ª canal ä»‹ç»ï¼‰ï¼ŒåŸºæœ¬å°±ç†è§£ CDC çš„å·¥ä½œåŸç†äº†ï¼Œæ›´è¯¦ç»†çš„å¯ä»¥ç‚¹å¼€ &lt;a href=&quot;https://github.com/alibaba/canal&quot;&gt;canal&lt;/a&gt; é“¾æ¥ï¼Œæœ‰æ›´å¤šçš„ä»‹ç»ã€‚
&lt;img src=&quot;/assets/images/canal.jpeg&quot; alt=&quot;canal å·¥ä½œåŸç†&quot; title=&quot;canal å·¥ä½œåŸç†&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å„ç§-cdc&quot;&gt;å„ç§ CDC&lt;/h3&gt;

&lt;p&gt;å› ä¸º CDC è½¯ä»¶ç¹å¤šï¼Œæˆ‘æ²¡æœ‰ä¸€ä¸€å®‰è£…å»å®éªŒï¼Œæ‰€ä»¥åˆ—ä¸¾å‡ ä¸ªï¼Œä¾›å¤§å®¶å‚è€ƒï¼Œæ›´å¤šçš„å¤§å®¶å¯ä»¥çœ‹&lt;a href=&quot;https://github.com/wushujames/mysql-cdc-projects/wiki&quot;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;åç§°&amp;amp;ç«™ç‚¹&lt;/td&gt;
      &lt;td&gt;æè¿°&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;https://github.com/alibaba/canal&quot;&gt;canal&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;é˜¿é‡Œå·´å·´å‡ºå“ï¼Œå¾ˆå¤šä¸­æ–‡æ–‡æ¡£ï¼Œæ¯”è¾ƒæˆç†Ÿ github star &amp;gt; 4k fork &amp;gt; 1700 å¤šï¼ŒJava è¯­è¨€å¼€å‘ï¼Œæœ‰é…å¥—å·¥å…·é“¾ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;https://github.com/linkedin/databus&quot;&gt;databus&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;star&amp;gt;1800,fork&amp;gt;400, å¤§å‚å‡ºå“ï¼Œè¿˜æ˜¯å€¼å¾—ä¿¡èµ–çš„ï¼ŒJava è¯­è¨€å®ç°&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;https://github.com/JarvusInnovations/lapidus&quot;&gt;lapidus&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;Nodejs å®ç°çš„ star 76 fork 10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;https://github.com/mardambey/mypipe&quot;&gt;mypipe&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;star&amp;gt;300 fork&amp;gt;50 Scala å®ç°çš„&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;https://github.com/siddontang/go-mysql-elasticsearch&quot;&gt;go-mysql-elasticsearch&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;star &amp;gt; 1k fork &amp;gt; 250 Golang&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;https://github.com/krowinski/php-mysql-replication&quot;&gt;php-mysql-replication&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;PHP çš„ï¼Œå“ˆå“ˆå“ˆ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;https://github.com/noplay/python-mysql-replication&quot;&gt;python-mysql-replication&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;Python çš„&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;cdc-ä½¿ç”¨åœºæ™¯å’Œ-cdc-åœ¨æˆ‘ä»¬æ¶æ„ä¸­çš„åº”ç”¨&quot;&gt;CDC ä½¿ç”¨åœºæ™¯å’Œ CDC åœ¨æˆ‘ä»¬æ¶æ„ä¸­çš„åº”ç”¨&lt;/h3&gt;

&lt;p&gt;CDC çš„åº”ç”¨åœºæ™¯å°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œæ•æ‰é‚£äº›å˜åŒ–çš„æ•°æ®ï¼Œä¸‹é¢ç®€å•è¯´å‡ ä¸ªå…·ä½“çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æ ¹æ®æˆ‘ä»¬çš„ä¸šåŠ¡ï¼Œç”¨æˆ·æŠ¥ååä¼šæœ‰ä¸€äº›åˆ—çš„æ•°æ®å˜åŒ–ï¼Œå½•å–ã€å¾…é¢è¯•ã€æ‹’ç»ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;ç”µå•†ä¸­çš„è®¢å•çŠ¶æ€å˜&lt;/li&gt;
  &lt;li&gt;æ•°æ®åº“æ•°æ®å˜æ›´æ›´æ–°æ£€ç´¢&lt;/li&gt;
  &lt;li&gt;â€¦â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸Šé¢åˆ—è§‰çš„è¿™å‡ ä¸ªä¾‹å­ï¼Œéƒ½ä¼šæ¶‰åŠåˆ°æ•°æ®å˜æ›´æ—¶ï¼Œè§¦å‘ä¸€äº›åˆ—çš„ä¸šåŠ¡æ“ä½œï¼Œç›´æ¥é€šè¿‡åº”ç”¨ç¨‹åºä»£ç è¿›è¡Œå¼‚æ­¥çš„äº‹ä»¶åˆ†å‘ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ï¼Œä»£ç ä¹Ÿå¯ä»¥åšåˆ°ä¸åµŒå…¥ä¸šåŠ¡ï¼Œä½†æ˜¯å¤šä¸šåŠ¡åœ¨å…±äº«æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯ä¸ªä¸šåŠ¡æ–¹éƒ½è¦å»å®ç°ç›‘å¬æ•°æ®å˜åŒ–çš„ä»£ç ã€‚è€Œé‡‡ç”¨ CDC è¿›è¡Œæ•°æ®åˆ†å‘ï¼Œæ˜¯æ¯”è¾ƒå¥½çš„å®ç°æ–¹å¼ï¼Œé€šè¿‡ CDC ç»Ÿä¸€åˆ†å‘ï¼Œä¸šåŠ¡æ–¹åªå…³å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä¸ç”¨å»å†™å¤§é‡ä»£ç æ¥åšå¼‚æ­¥å®ç°æ•°æ®ç›‘å¬æ¥æ”¶ï¼Œä¸‹é¢æ˜¯æˆ‘ç†è§£çš„ä¸€ä¸ªåŸºäº CDC å’Œ Queue æ¥åšçš„æ•°æ®åˆ†å‘å’Œå…±äº«å¹³å°çš„æ¶æ„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/cdc_queue_share_data.jpeg&quot; alt=&quot;CDC Queue Dispatcher Data&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡ä¸Šé¢çš„è¿™å¥—ä½“ç³»ï¼ŒMySQL é€šè¿‡ CDC æŠŠè¡¨å˜åŒ–çš„æ•°æ®åˆ†å‘å‡ºæ¥ï¼Œå­˜å…¥ç›¸åº”çš„å…±äº«é˜Ÿåˆ—ï¼Œæ¯ä¸ªæƒ³è¦ä½¿ç”¨è¯¥æ•°æ®çš„çš„ä¸šåŠ¡æ–¹ï¼Œéƒ½å¯ä»¥é€šè¿‡å»è®¢é˜…è¿™ä»½æ•°æ®æ¥å®Œæˆè‡ªå·±çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œåœ¨ä»£ç ä¸ŠåŸºæœ¬æ˜¯å®Œå…¨åˆ†ç¦»äº†æ•°æ®é‡‡é›†çš„å·¥ä½œã€‚åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯&lt;strong&gt;&lt;em&gt;æ•°æ®æ˜¯å•å‘æµå‘ä¸šåŠ¡æ–¹çš„ï¼Œæ‰€ä»¥åœ¨æ•°æ®ä½¿ç”¨ä¸Šä¸€å®šè¦åˆ‡åˆå®é™…çš„ä¸šåŠ¡åŠŸèƒ½&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç›®å‰æˆ‘ä»¬çš„æ¶æ„ä¸­ï¼Œåªæ˜¯éƒ¨åˆ†ä½¿ç”¨äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œä¸”æ¯”è¾ƒé›¶æ•£ï¼Œæ²¡æœ‰ä»å…¨å±€ä¸Šé¢ç»Ÿç­¹æ•°æ®åˆ†å‘ï¼Œæˆ‘ä»¬åº”ç”¨æœ€å¤šçš„æ˜¯æ•°æ®åº“æ•°æ®å˜åŒ–æ—¶ï¼Œæ›´æ–°æ£€ç´¢ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å¦‚ä½•å®ç°ä¸€ä¸ª-cdc&quot;&gt;å¦‚ä½•å®ç°ä¸€ä¸ª CDCï¼Ÿ&lt;/h3&gt;

&lt;p&gt;MySQL çš„ä¸€äº› CDC è½¯ä»¶å°±æ˜¯å®ç°äº† &lt;a href=&quot;https://dev.mysql.com/doc/internals/en/replication-protocol.html&quot;&gt;MySQL-replication&lt;/a&gt; åè®®çš„ Slave åº“ï¼Œåªæ˜¯æœ¬èº«å¹¶ä¸å­˜å‚¨æ•°æ®ï¼Œåšä¸€äº›æ•°æ®è§£æå’Œåˆ†å‘åŠŸèƒ½ã€‚æ–‡ä¸­åˆ—ä¸¾äº†å„ç§è¯­è¨€çš„å®ç°ï¼Œå¹¶ä¸”éƒ½æœ‰é“¾æ¥åœ°å€ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œéƒ¨ç½²å»ç©äº†ã€‚&lt;/p&gt;

&lt;p&gt;PS: æœ¬æ¥è¦è‡ªå·±å®ç°ä¸€ä¸‹å‘ç°æœ‰ PHP ç‰ˆæœ¬äº†ï¼ŒğŸ˜‚ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æŸ¥çœ‹ä¸Šé¢åˆ—å‡ºæ¥çš„ PHP çš„å®ç°ï¼Œä¸€ä¸ªç®€å•çš„&lt;a href=&quot;https://github.com/outman/weekly/tree/master/02&quot;&gt;ç¤ºä¾‹ä»£ç &lt;/a&gt;ã€‚&lt;/p&gt;</content><author><name></name></author><summary type="html">èƒŒæ™¯</summary></entry><entry><title type="html">åŸºäº Redis çš„å»¶æ—¶é˜Ÿåˆ—è®¾è®¡ä¸å®ç°ï¼ˆä¸€å‘¨å­¦ä¹ æŠ¥-ç¬¬1æœŸï¼‰</title><link href="http://rust.love/2018/02/04/study_weekly_01.html" rel="alternate" type="text/html" title="åŸºäº Redis çš„å»¶æ—¶é˜Ÿåˆ—è®¾è®¡ä¸å®ç°ï¼ˆä¸€å‘¨å­¦ä¹ æŠ¥-ç¬¬1æœŸï¼‰" /><published>2018-02-04T22:46:45+08:00</published><updated>2018-02-04T22:46:45+08:00</updated><id>http://rust.love/2018/02/04/study_weekly_01</id><content type="html" xml:base="http://rust.love/2018/02/04/study_weekly_01.html">&lt;h3 id=&quot;æœ¬æœŸç›®æ ‡&quot;&gt;æœ¬æœŸç›®æ ‡&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;äº†è§£å»¶æ—¶é˜Ÿåˆ—çš„å·¥ä½œåŸç†&lt;/li&gt;
  &lt;li&gt;è‡ªå·±å¯ä»¥é€šè¿‡ç°æœ‰çš„å·¥å…·è½¯ä»¶æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—æœåŠ¡&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å»¶æ—¶é˜Ÿåˆ—åº”ç”¨åœºæ™¯&quot;&gt;å»¶æ—¶é˜Ÿåˆ—åº”ç”¨åœºæ™¯&lt;/h3&gt;

&lt;p&gt;å»¶æ—¶é˜Ÿåˆ—æœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œç®€å•æ¥è¯´éœ€è¦åœ¨æœªæ¥æŸä¸ªç‰¹å®šæ—¶é—´å»æ‰§è¡Œçš„ä»»åŠ¡ï¼Œéƒ½å¯ä»¥é‡‡ç”¨å»¶æ—¶é˜Ÿåˆ—ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸‹è®¢å•å 30 åˆ†é’Ÿæœªæ”¯ä»˜çš„é‡Šæ”¾è®¢å•ã€‚&lt;/li&gt;
  &lt;li&gt;ç”¨æˆ·å®ŒæˆæŸä¸ªåŠŸèƒ½åï¼ŒN å¤©æ¨é€ä¸ªæ¶ˆæ¯ã€‚&lt;/li&gt;
  &lt;li&gt;å½“å‰æˆ‘ä»¬çš„ä½¿ç”¨åœºæ™¯å°±å±äºç”¨æˆ·è¢«å•†å®¶å¤„ç†åï¼Œéœ€è¦ 2 å¤©åç»™ç”¨æˆ·åé¦ˆæ¶ˆæ¯ã€‚&lt;/li&gt;
  &lt;li&gt;â€¦â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸Šé¢æåˆ°çš„è¿™äº›åœºæ™¯å¦‚æœä¸ç”¨å»¶æ—¶é˜Ÿåˆ—éƒ½æ˜¯å¯ä»¥å¤„ç†çš„ï¼Œä¾‹å¦‚è½®è®­ DB ç­‰ï¼Œå¦‚æœé‡‡ç”¨äº†å»¶æ—¶é˜Ÿåˆ—ä¼šæœ‰æ›´å¥½çš„æ•ˆæœï¼Œé™¤äº†ä»¥ä¸Šçš„åº”ç”¨åœºæ™¯ï¼Œè¿˜æœ‰å¾ˆå¤šï¼Œå¯ä»¥è‡ªå·±æ¢ç´¢ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä¸ºä»€ä¹ˆè¦åŸºäº-redis-å»è®¾è®¡ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—&quot;&gt;ä¸ºä»€ä¹ˆè¦åŸºäº Redis å»è®¾è®¡ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—&lt;/h3&gt;

&lt;p&gt;å·²ç»å¾ˆæœ‰ä¸€äº›ä¸é”™çš„å»¶æ—¶é˜Ÿåˆ—äº§å“ã€‚ä¾‹å¦‚ BeansTalkï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œåªä¸ºæ•™å­¦ç›®çš„ï¼Œæ‰€ä»¥è‡ªå·±è®¾è®¡ä¸€å¥—ï¼ŒåŸºäº PHP å’Œ Redis çš„ä»£ç ç®€å•ï¼Œé€šè¿‡è‡ªå·±è®¾è®¡è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥å¢å¼ºä¸€äº›æ¦‚å¿µå’Œäº†è§£åŸç†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä½¿ç”¨-rabbitmq-æ­»ä¿¡æ–¹å¼å­˜åœ¨çš„é—®é¢˜&quot;&gt;ä½¿ç”¨ RabbitMQ æ­»ä¿¡æ–¹å¼å­˜åœ¨çš„é—®é¢˜&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;åŒä¸€ä¸ªé˜Ÿåˆ—å†…ï¼Œæ•°æ®å»¶æ—¶æ—¶é—´ä¸å›ºå®šï¼Œä¼šæœ‰é˜»å¡é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ¶‰åŠçš„åè¯è§£é‡Š&quot;&gt;æ¶‰åŠçš„åè¯è§£é‡Š&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Queue å°±æ˜¯æ­£å¸¸çš„é˜Ÿåˆ—&lt;/li&gt;
  &lt;li&gt;enqueue å…¥é˜Ÿ&lt;/li&gt;
  &lt;li&gt;dequeue å‡ºå¯¹&lt;/li&gt;
  &lt;li&gt;Buckt å»¶æ—¶é˜Ÿåˆ—æ•°æ®çš„å­˜å‚¨å™¨&lt;/li&gt;
  &lt;li&gt;Scanner æ‰«æ Bucketï¼Œå¯»æ‰¾ç¬¦åˆæ¡ä»¶çš„æ•°æ®&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;buckt-è®¾è®¡æ€è·¯&quot;&gt;Buckt è®¾è®¡æ€è·¯&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸ºæ¯æ¡æ¶ˆæ¯ç”Ÿæˆå”¯ä¸€æ ‡è¯†ï¼ŒZSET å­˜å‚¨æ•°æ®çš„å»¶æ—¶æ’åº { value: uuid, score: delay_seconds}&lt;/li&gt;
  &lt;li&gt;Hash å­˜å‚¨å…·ä½“å¯¹åº”çš„æ•°æ® { key : uuid, value : data}&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ‰«æ Bucket çš„ ZSET å†…çš„æ•°æ®ï¼Œå¦‚æœ delay_seconds æ»¡è¶³æ¡ä»¶ï¼Œæ ¹æ® uuid å–å‡º  Hash å†…æ•°æ®ï¼Œå‘é€åˆ°æ­£å¸¸é˜Ÿåˆ—ï¼Œåˆ é™¤ ZSET å’Œ Hash å†…çš„å…ƒç´ ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†æé«˜æ•ˆç‡ï¼Œé™ä½å»¶æ—¶ï¼Œå¯¹æ•´ä¸ªæœåŠ¡é»˜è®¤åˆ†äº† 4 ä¸ª Bucketï¼Œæ¯ä¸ª Bucket å¯¹åº”ä¸€ä¸ªè¿›ç¨‹å»æ‰«æå¤„ç†ã€‚æ–‡æ¡£å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/study_weekly_01_01.jpeg&quot; alt=&quot;æ•°æ®æµç¨‹å’Œæ–‡æ¡£ 01&quot; /&gt;
&lt;img src=&quot;/assets/images/study_weekly_01_02.jpeg&quot; alt=&quot;æ•°æ®æµç¨‹å’Œæ–‡æ¡£ 02&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æºç åœ°å€ï¼š &lt;a href=&quot;https://github.com/outman/dq&quot;&gt;http://github.com/outman&lt;/a&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">æœ¬æœŸç›®æ ‡ äº†è§£å»¶æ—¶é˜Ÿåˆ—çš„å·¥ä½œåŸç† è‡ªå·±å¯ä»¥é€šè¿‡ç°æœ‰çš„å·¥å…·è½¯ä»¶æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—æœåŠ¡</summary></entry><entry><title type="html">reqargs lua tcp socket read timed out</title><link href="http://rust.love/2017/10/30/lua_tcp_socket_read_timed_out_reqargs.html" rel="alternate" type="text/html" title="reqargs lua tcp socket read timed out" /><published>2017-10-30T23:57:58+08:00</published><updated>2017-10-30T23:57:58+08:00</updated><id>http://rust.love/2017/10/30/lua_tcp_socket_read_timed_out_reqargs</id><content type="html" xml:base="http://rust.love/2017/10/30/lua_tcp_socket_read_timed_out_reqargs.html">&lt;p&gt;ä¸Šä¼ æ–‡ä»¶ï¼Œå› ä¸ºè¿˜æœ‰å…¶å®ƒ form å‚æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨äº† reqargs
æ¨¡å—ï¼Œå‘ç°åœ¨é”™è¯¯æ—¥å¿—é‡Œå‡ºç°äº†&lt;/p&gt;
&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;mi&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;29&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;15189&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;641&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lua&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tcp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timed&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯¼è‡´è¿™ä¸ªé—®é¢˜åŸå› æœ‰å¾ˆå¤šï¼Œå¯ä»¥æœç´¢ä¸‹ nginx ç›¸å…³çš„ä¸€äº›è®¾ç½®ï¼Œåœ¨è°ƒæ•´äº† nginx
ä¸€äº›ç›¸å…³çš„ timeout å‚æ•°æ— æœåï¼Œå»ç¿»äº†ä¸€ä¸‹ reqargs
çš„ä»£ç ï¼ŒåŸæ¥æ˜¯åœ¨è¯»å–ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™è¶…æ—¶äº†ï¼Œè€Œ reqargs æ˜¯æœ‰ timeout
è®¾ç½®çš„ï¼Œåªæ˜¯æˆ‘æ²¡æœ‰åœ¨æ–‡æ¡£é‡Œçœ‹åˆ°ï¼Œè¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;multipart/form-data&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmpdr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp_dir&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp_dir&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmpdr&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmpdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sep&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;tmpdr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmpdr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sep&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxfz&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max_file_size&lt;/span&gt;    &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max_file_size&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxfs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max_file_uploads&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max_file_uploads&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chunk&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chunk_size&lt;/span&gt;       &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chunk_size&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chunk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max_line_size&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max_line_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set_timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ª timeoutm å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤å°±æ˜¯ 1000ï¼Œä¸»è¦æ˜¯åœ¨æ¨¡å—åˆå§‹åŒ–çš„æ—¶å€™è®¾ç½®&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;files&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;reqargs&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3600&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ”¹ä¸º 3600 åï¼Œé—®é¢˜æ¶ˆå¤±ã€‚&lt;/p&gt;</content><author><name></name></author><summary type="html">ä¸Šä¼ æ–‡ä»¶ï¼Œå› ä¸ºè¿˜æœ‰å…¶å®ƒ form å‚æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨äº† reqargs æ¨¡å—ï¼Œå‘ç°åœ¨é”™è¯¯æ—¥å¿—é‡Œå‡ºç°äº† 2017/10/30 22:29:42 [error] 15189#0: *641 lua tcp socket read timed out</summary></entry><entry><title type="html">Laravel ä¸­ Event çš„æ‰§è¡Œæµç¨‹</title><link href="http://rust.love/2017/09/21/laravel_event.html" rel="alternate" type="text/html" title="Laravel ä¸­ Event çš„æ‰§è¡Œæµç¨‹" /><published>2017-09-21T20:05:17+08:00</published><updated>2017-09-21T20:05:17+08:00</updated><id>http://rust.love/2017/09/21/laravel_event</id><content type="html" xml:base="http://rust.love/2017/09/21/laravel_event.html">&lt;p&gt;Laravel ä¸­å·²ç»æœ‰å…³äº Event çš„è¯´æ˜å’Œä»‹ç»äº†ï¼Œæ–‡æ¡£ä¸­ä¸»è¦è®²è¿°äº†æ€ä¹ˆä½¿ç”¨å’Œ Event çš„ç¤ºä¾‹åœºæ™¯å’ŒåŠŸèƒ½ï¼Œä¸‹é¢ä¸»è¦è¯´ä¸‹æ•´ä¸ª Event çš„æ‰§è¡Œè¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;application&quot;&gt;Application&lt;/h3&gt;

&lt;p&gt;ä»ç¨‹åºçš„å…¥å£ public/index.phpï¼Œé¡¹ç›®åŠ è½½äº† bootstrap/app.php æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸»è¦æ˜¯è¿”å›ä¸€ä¸ª Application å¯¹è±¡ $appï¼Œåœ¨ Application è¿™ä¸ªç±»é‡Œæœ‰ä¸‹é¢çš„è¿™ä¸ªæ–¹æ³•ï¼Œä¸»è¦æ˜¯æ³¨å†Œ Providers çš„ï¼Œç¨åæˆ‘ä»¬ä¼šè®²è§£è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ç‚¹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;registerConfiguredProviders&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$providers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'app.providers'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;partition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Str&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;startsWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Illuminate\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// è¿™é‡Œå°†è‡ªå®šä¹‰çš„å’Œç³»ç»Ÿçš„åŒºåˆ†å¼€ï¼Œå½¢æˆ [Ill..., App...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$providers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;splice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;PackageManifest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()]);&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ProviderRepository&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Filesystem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getCachedServicesPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$providers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;collapse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åŠ è½½å®Œ bootstrap/app.php æ–‡ä»¶ä»¥åï¼Œçœ‹ public/index.php ä¸‹é¢è¿™æ®µä»£ç &lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$kernel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Illuminate\Contracts\Http\Kernel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$kernel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Illuminate\Http\Request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;capture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ $app-&amp;gt;make åˆ›å»º Kernel å¯¹è±¡çš„æ—¶å€™ï¼Œ Application è¢«é»˜è®¤æ³¨å…¥äº†ï¼Œæ‰€ä»¥ $kernel-&amp;gt;app å°±æ˜¯ Application ç±»çš„å®ä¾‹ã€‚$kernel-&amp;gt;handle() ä¸»è¦è°ƒç”¨äº†ä¸‹é¢å‡ ä¸ªæ–¹æ³•ï¼Œ&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$kernel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendRequestThroughRouter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$kernel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$kernel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bootstrapWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­ $app-&amp;gt;bootstrapWith æ–¹æ³•ä¸»è¦æ˜¯å»å¾ªç¯å¤„ç† $kernel-&amp;gt;bootstrappers è¿™ä¸ªæ•°ç»„ï¼Œå®ä¾‹åŒ–æ¯ä¸ªç±»ï¼Œå¹¶ä¸”è°ƒç”¨è¯¥ç±»çš„ bootstrap($app) æ–¹æ³•&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;protected $bootstrappers = [
\Illuminate\Foundation\Bootstrap\LoadEnvironmentVariables::class,
\Illuminate\Foundation\Bootstrap\LoadConfiguration::class,
\Illuminate\Foundation\Bootstrap\HandleExceptions::class,
\Illuminate\Foundation\Bootstrap\RegisterFacades::class,
\Illuminate\Foundation\Bootstrap\RegisterProviders::class,
\Illuminate\Foundation\Bootstrap\BootProviders::class,
];
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™é‡Œé¢æˆ‘ä»¬éœ€è¦å…³æ³¨çš„å°±æ˜¯ \Illuminate\Foundation\Bootstrap\RegisterProviders::class è¿™ä¸ªç±»ï¼Œä¸‹é¢çœ‹ä¸‹è¿™ä¸ªç±»çš„å…·ä½“ä»£ç &lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RegisterProviders&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
* Bootstrap the given application.
*
* @param  \Illuminate\Contracts\Foundation\Application  $app
* @return void
*/&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Application&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// è¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸Šé¢ç¬¬ä¸€ä¸ªåœ°æ–¹ä»‹ç»çš„æ–¹æ³•ã€‚&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;registerConfiguredProviders&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;providerrepository&quot;&gt;ProviderRepository&lt;/h3&gt;

&lt;p&gt;ä¸Šé¢çš„ä»£ç ä¸»è¦è®²äº†ä»å…¥å£åˆ° ProviderRepository çš„è¿‡ç¨‹ï¼Œä¸‹é¢ä¸»è¦è®² ProviderRepository ä¹‹åçš„è¿‡ç¨‹ï¼Œåœ¨ ProviderRepository ç±»é‡Œæœ‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³• loadï¼Œä»£ç å¦‚ä¸‹&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$manifest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;loadManifest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// First we will load the service manifest, which contains information on all&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// service providers registered with the application and which services it&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// provides. This is used to know which services are &quot;deferred&quot; loaders.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;shouldRecompile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$manifest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$manifest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;compileManifest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Next, we will register events to load the providers for each of the events&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// that it has requested. This allows the service provider to defer itself&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// while still getting automatically loaded when a certain event occurs.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$manifest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'when'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;registerLoadEvents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// We will go ahead and register all of the eagerly loaded providers with the&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// application so their services can be registered with the application as&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// a provided service. Then we will set the deferred service list on it.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$manifest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'eager'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;addDeferredServices&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$manifest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'deferred'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ³¨æ„ä¸Šé¢çš„ load æ–¹æ³•ï¼Œ Providers ä¼šè¢«åˆ†ä¸ºå‡ ç±»ï¼Œdefer when eagerï¼Œå…·ä½“çœ‹ Provider çš„ç±»å‹æ¥åŒºåˆ†çš„ï¼Œæˆ‘ä»¬çš„ App\Providers\EventServiceProvider å°±å±äº eagerã€‚è¿™é‡Œ $this-&amp;gt;app-&amp;gt;register() è°ƒç”¨ï¼Œæ³¨å†Œ Providerï¼Œä¸”è°ƒç”¨äº†è¯¥ Provider çš„ register æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[],&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$force&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$registered&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$force&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$registered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// If the given &quot;provider&quot; is a string, we will resolve it, passing in the&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// application instance automatically for the developer. This is simply&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// a more convenient way of specifying your service provider classes.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;is_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;resolveProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;method_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'register'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// æ³¨æ„è¿™é‡Œ&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;markAsRegistered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// If the application has already booted, we will call this boot method on&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// the provider class so it has an opportunity to do its boot logic and&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// will be ready for any usage by this developer's application logic.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;booted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bootProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// æ³¨æ„è¿™é‡Œ&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è°ƒç”¨å®Œ register æ–¹æ³•ä¹‹åï¼Œåœ¨ register è¿™ä¸ªæ–¹æ³•ä¹‹åè°ƒç”¨äº† $bootProviderï¼Œè¿™ä¸ªæ–¹æ³•è°ƒç”¨äº† Provider çš„ boot æ–¹æ³•ã€‚&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bootProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ServiceProvider&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;method_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'boot'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'boot'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;eventserviceprovider&quot;&gt;EventServiceProvider&lt;/h3&gt;

&lt;p&gt;åœ¨ EventServiceProvider ç±»ä¸­ï¼Œboot è¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œä»–å®Œæˆäº† Event å’Œ Listener çš„åˆå§‹åŒ–å·¥ä½œï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;boot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;listens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$listeners&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listeners&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;subscribe&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$subscriber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$subscriber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ Dispatcher çš„ listen æ–¹æ³•ï¼š&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$events&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Str&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'*'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setupWildcardListen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// è¿™é‡Œï¼Œæœ€åè°ƒç”¨äº† makeListener æ–¹æ³•&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;listeners&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;makeListener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// è¿™ä¸ªæ–¹æ³•å¯¹ listener è¿›è¡Œäº†åˆå§‹åŒ–&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸Šé¢ä»£ç å¯¹ Listener åšäº†åˆå§‹åŒ–å·¥ä½œï¼Œè¿™æ ·å¯ä»¥åœ¨æ¥ä¸‹æ¥çš„è°ƒç”¨ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”åˆå§‹åŒ–ä¹‹åæ˜¯ä¸€ä¸ª callable ç±»å‹ï¼Œä¹‹åæ•´ä¸ªäº‹ä»¶åˆå§‹åŒ–å·¥ä½œåŸºæœ¬å®Œæˆï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨äº‹ä»¶ã€‚&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;createClassListener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$wildcard&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// æ³¨æ„è¿™ä¸ªè¿”å›&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$wildcard&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$wildcard&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;call_user_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createClassCallable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;call_user_func_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createClassCallable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$payload&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;createClassCallable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseClassCallable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;handlerShouldBeQueued&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// è¿™é‡Œå†³å®šæ˜¯å¦ä½¿ç”¨å¼‚æ­¥é˜Ÿåˆ—æ¥æ¥å—äº‹ä»¶&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createQueuedHandlerCallable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parseClassCallable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Str&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'handle'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;eventfire&quot;&gt;Event::fire&lt;/h3&gt;

&lt;p&gt;Event ç³»ç»Ÿåˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬æ˜¯éœ€è¦ä½¿ç”¨äº‹ä»¶çš„ï¼Œä¸‹é¢å°±è®²ä¸‹äº‹ä»¶çš„è§¦å‘ï¼Œäº‹ä»¶çš„è§¦å‘ä¸»è¦æ˜¯ Event::fire å’Œ event å…¶å®ä»–ä»¬å¹¶æ²¡æœ‰ä»€ä¹ˆå¤§åŒºåˆ«ï¼Œåº•å±‚éƒ½æ˜¯ç›¸åŒçš„ä»£ç ã€‚&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[],&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$halt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// When the given &quot;event&quot; is actually an object we will assume it is an event&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// object and use the class as the event name and this event itself as the&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// payload to the handler, which makes object based events quite simple.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseEventAndPayload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$payload&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;shouldBroadcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;broadcastEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$responses&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getListeners&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// æ³¨æ„ä¸‹é¢è¿™è¡Œä»£ç ï¼Œå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ Listener åˆå§‹åŒ–ä¸ºä¸€ä¸ª callableï¼Œè¿™æ · $listener($event, $payload) æ‰å¯ä»¥è°ƒç”¨ã€‚&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$listener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// If a response is returned from the listener and event halting is enabled&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// we will just return this response, and not call the rest of the event&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// listeners. Otherwise we will add the response on the response list.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$halt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;is_null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// If a boolean false is returned from a listener, we will stop propagating&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// the event to any further listeners down in the chain, else we keep on&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// looping through the listeners and firing every one in our sequence.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$responses&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$halt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$responses&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªäº‹ä»¶çš„ä¸»è¦æ‰§è¡Œè¿‡ç¨‹ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠ Broadcast å’Œ Subscribeï¼Œç›¸å…³ä»£ç åŸºæœ¬å·²ç»ç©¿æ’å…¶ä¸­ï¼Œå¼‚æ­¥äº‹ä»¶ä¿å­˜åˆ°é˜Ÿåˆ—ï¼Œæ˜¯ç”± Listener å†³å®šçš„ï¼Œå¦‚æœä¿å­˜åˆ°é˜Ÿåˆ—ï¼Œé‚£ä¹ˆéœ€è¦é€šè¿‡æ¶ˆè€—é˜Ÿåˆ—æ¥è§¦å‘äº‹ä»¶ï¼Œæ–‡æ¡£æœ‰æ‰‹åŠ¨è§¦å‘å’Œè‡ªåŠ¨è§¦å‘ç›¸å…³çš„å†…å®¹ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹å­˜å‚¨åœ¨é˜Ÿåˆ—é‡Œçš„æ•°æ®ç»“æ„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascrpt&quot;&gt;{
&quot;displayName&quot;:&quot;App\\Listeners\\EventListener&quot;,
&quot;job&quot;:&quot;Illuminate\\Queue\\CallQueuedHandler@call&quot;,
&quot;maxTries&quot;:null,
&quot;timeout&quot;:null,
&quot;timeoutAt&quot;:null,
&quot;data&quot;:{
&quot;commandName&quot;:&quot;Illuminate\\Events\\CallQueuedListener&quot;,
&quot;command&quot;:&quot;O:36:\\&quot;Illuminate\\Events\\CallQueuedListener\\&quot;:7:{s:5:\\&quot;class\\&quot;;s:27:\\&quot;App\\Listeners\\EventListener\\&quot;;s:6:\\&quot;method\\&quot;;s:6:\\&quot;handle\\&quot;;s:4:\\&quot;data\\&quot;;a:1:{i:0;O:16:\\&quot;App\\Events\\Event\\&quot;:2:{s:5:\\&quot;input\\&quot;;a:2:{s:1:\\&quot;a\\&quot;;i:1;s:1:\\&quot;b\\&quot;;i:2;}s:6:\\&quot;socket\\&quot;;N;}}s:5:\\&quot;tries\\&quot;;N;s:9:\\&quot;timeoutAt\\&quot;;N;s:7:\\&quot;timeout\\&quot;;N;s:6:\\&quot;\\u0000*\\u0000job\\&quot;;N;}&quot;
},
&quot;id&quot;:&quot;HI2SZiCD3K4Mmgu46RpLz13k4WhkWQAj&quot;,
&quot;attempts&quot;:0
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…³äºæ¶ˆè€—é˜Ÿåˆ—é‡Œçš„å†…å®¹å°±ä¸å†™äº†ã€‚&lt;/p&gt;

&lt;p&gt;END.&lt;/p&gt;</content><author><name></name></author><summary type="html">Laravel ä¸­å·²ç»æœ‰å…³äº Event çš„è¯´æ˜å’Œä»‹ç»äº†ï¼Œæ–‡æ¡£ä¸­ä¸»è¦è®²è¿°äº†æ€ä¹ˆä½¿ç”¨å’Œ Event çš„ç¤ºä¾‹åœºæ™¯å’ŒåŠŸèƒ½ï¼Œä¸‹é¢ä¸»è¦è¯´ä¸‹æ•´ä¸ª Event çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</summary></entry><entry><title type="html">luminus web é…ç½® c3p0 æ•°æ®åº“é“¾æ¥æ± </title><link href="http://rust.love/2017/09/11/luminusweb_with_c3p0.html" rel="alternate" type="text/html" title="luminus web é…ç½® c3p0 æ•°æ®åº“é“¾æ¥æ± " /><published>2017-09-11T18:33:47+08:00</published><updated>2017-09-11T18:33:47+08:00</updated><id>http://rust.love/2017/09/11/luminusweb_with_c3p0</id><content type="html" xml:base="http://rust.love/2017/09/11/luminusweb_with_c3p0.html">&lt;p&gt;luminus çš„ db æ“ä½œå·¥å…·ä¸å¤ªå¥½ç”¨ï¼Œæ‰€ä»¥æ¢æˆäº† funcool çš„ jdbc å’Œ c3p0ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å¢åŠ ä¾èµ–&quot;&gt;å¢åŠ ä¾èµ–&lt;/h3&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;funcool/clojure.jdbc&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0.9.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mysql/mysql-connector-java&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;5.1.6&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;com.mchange/c3p0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0.9.5&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;é…ç½®-dbpool&quot;&gt;é…ç½® dbpool&lt;/h3&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dbpool&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;doto&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ComboPooledDataSource.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setJdbcUrl&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;jdbc:&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:subprotocol&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dbspec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;:&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:subname&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dbspec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setUser&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:dbuser&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dbspec&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setPassword&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:dbpasswd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dbspec&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setMinPoolSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setMaxPoolSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setMaxConnectionAge&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3600&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; 1 hour&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setMaxIdleTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1800&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;       &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; 1/2 hour&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setMaxIdleTimeExcessConnections&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;120&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setTestConnectionOnCheckin&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setTestConnectionOnCheckout&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.setIdleConnectionTestPeriod&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;600&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ä½¿ç”¨&quot;&gt;ä½¿ç”¨&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(defn topic-fetch-all
[]
(with-open [conn (jdbc/connection dbpool)]
(let [result (jdbc/fetch conn &quot;select @@version&quot;)]
(first result))))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;END.&lt;/p&gt;</content><author><name></name></author><summary type="html">luminus çš„ db æ“ä½œå·¥å…·ä¸å¤ªå¥½ç”¨ï¼Œæ‰€ä»¥æ¢æˆäº† funcool çš„ jdbc å’Œ c3p0ã€‚</summary></entry><entry><title type="html">RabbitMQ é˜Ÿåˆ—ç§¯å‹</title><link href="http://rust.love/2017/09/05/rabbitmq_some_tips.html" rel="alternate" type="text/html" title="RabbitMQ é˜Ÿåˆ—ç§¯å‹" /><published>2017-09-05T12:10:31+08:00</published><updated>2017-09-05T12:10:31+08:00</updated><id>http://rust.love/2017/09/05/rabbitmq_some_tips</id><content type="html" xml:base="http://rust.love/2017/09/05/rabbitmq_some_tips.html">&lt;p&gt;&lt;a href=&quot;/assets/images/Rabbitmq.pdf&quot;&gt;RabbitMQ ä¸€æ¬¡é˜Ÿåˆ—ç§¯å‹&lt;/a&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">RabbitMQ ä¸€æ¬¡é˜Ÿåˆ—ç§¯å‹</summary></entry><entry><title type="html">Some Git Tips</title><link href="http://rust.love/2016/01/29/some_git_tils.html" rel="alternate" type="text/html" title="Some Git Tips" /><published>2016-01-29T13:59:39+08:00</published><updated>2016-01-29T13:59:39+08:00</updated><id>http://rust.love/2016/01/29/some_git_tils</id><content type="html" xml:base="http://rust.love/2016/01/29/some_git_tils.html">&lt;p&gt;æŸ¥çœ‹æ“ä½œå†å²è®°å½•&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git reflog
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸è·Ÿè¸ªå·²ç»åŠ å…¥ç‰ˆæœ¬åº“çš„æ–‡ä»¶åœ¨æœ¬åœ°çš„ä¿®æ”¹&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.gitignore åŠ å…¥è¯¥æ–‡ä»¶ filename
git update-index --no-assume-unchanged filename
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><summary type="html">æŸ¥çœ‹æ“ä½œå†å²è®°å½• git reflog</summary></entry><entry><title type="html">PHPè®¾è®¡æ¨¡å¼-è£…é¥°æ¨¡å¼å®ç°éä¾µå…¥å¼ç¼“å­˜</title><link href="http://rust.love/2016/01/29/php_decorator_pattern_non_intrusive_cache.html" rel="alternate" type="text/html" title="PHPè®¾è®¡æ¨¡å¼-è£…é¥°æ¨¡å¼å®ç°éä¾µå…¥å¼ç¼“å­˜" /><published>2016-01-29T13:14:58+08:00</published><updated>2016-01-29T13:14:58+08:00</updated><id>http://rust.love/2016/01/29/php_decorator_pattern_non_intrusive_cache</id><content type="html" xml:base="http://rust.love/2016/01/29/php_decorator_pattern_non_intrusive_cache.html">&lt;h2 id=&quot;æœ¬æ–‡çš„ç›®æ ‡&quot;&gt;æœ¬æ–‡çš„ç›®æ ‡&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;ç®€å•å‡ æ­¥ï¼Œè½»æ¾å®ç°éä¾µå…¥å¼ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;æœ¬æ–‡çš„æ¶‰åŠåè¯&quot;&gt;æœ¬æ–‡çš„æ¶‰åŠåè¯&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;è£…é¥°æ¨¡å¼ (ä¹Ÿå«ä¿®é¥°æ¨¡å¼ï¼Œåªæ˜¯ç¿»è¯‘ä¸åŒ)&lt;/li&gt;
  &lt;li&gt;éä¾µå…¥å¼&lt;/li&gt;
  &lt;li&gt;ä¾èµ–æ³¨å…¥&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;åè¯è§£é‡Š&quot;&gt;åè¯è§£é‡Š&lt;/h2&gt;

&lt;h3 id=&quot;è£…é¥°æ¨¡å¼&quot;&gt;è£…é¥°æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;è£…é¥°æ¨¡å¼ï¼Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹é¢†åŸŸä¸­ï¼Œä¸€ç§åŠ¨æ€åœ°å¾€ä¸€ä¸ªç±»ä¸­æ·»åŠ æ–°çš„è¡Œä¸ºçš„è®¾è®¡æ¨¡å¼ã€‚å°±åŠŸèƒ½è€Œè¨€ï¼Œä¿®é¥°æ¨¡å¼ç›¸æ¯”ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ï¼Œè¿™æ ·å¯ä»¥ç»™æŸä¸ªå¯¹è±¡è€Œä¸æ˜¯æ•´ä¸ªç±»æ·»åŠ ä¸€äº›åŠŸèƒ½ã€‚&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E4%BF%AE%E9%A5%B0%E6%A8%A1%E5%BC%8F&quot;&gt;ä¿®é¥°æ¨¡å¼&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;éä¾µå…¥å¼&quot;&gt;éä¾µå…¥å¼&lt;/h3&gt;
&lt;p&gt;ç®€å•çš„è¯´å°±æ˜¯æ–°åŠ åŠŸèƒ½æˆ–è€…ä»£ç æ”¹åŸæœ‰ä»£ç &lt;/p&gt;

&lt;h3 id=&quot;ä¾èµ–æ³¨å…¥&quot;&gt;ä¾èµ–æ³¨å…¥&lt;/h3&gt;
&lt;p&gt;æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼Œç¼©å†™ä¸ºIoCï¼‰ï¼Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå¯ä»¥ç”¨æ¥å‡ä½è®¡ç®—æœºä»£ç ä¹‹é—´çš„è€¦åˆåº¦ã€‚å…¶ä¸­æœ€å¸¸è§çš„æ–¹å¼å«åšä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§°DIï¼‰ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å«â€œä¾èµ–æŸ¥æ‰¾â€ï¼ˆDependency Lookupï¼‰ã€‚é€šè¿‡æ§åˆ¶åè½¬ï¼Œå¯¹è±¡åœ¨è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œç”±ä¸€ä¸ªè°ƒæ§ç³»ç»Ÿå†…æ‰€æœ‰å¯¹è±¡çš„å¤–ç•Œå®ä½“ï¼Œå°†å…¶æ‰€ä¾èµ–çš„å¯¹è±¡çš„å¼•ç”¨ä¼ é€’ç»™å®ƒã€‚ä¹Ÿå¯ä»¥è¯´ï¼Œä¾èµ–è¢«æ³¨å…¥åˆ°å¯¹è±¡ä¸­ã€‚&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC&quot;&gt;æ§åˆ¶åè½¬&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;å…·ä½“å®ç°&quot;&gt;å…·ä½“å®ç°&lt;/h2&gt;

&lt;p&gt;å¸¸è§çš„ç¼“å­˜ä»£ç ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UserModel&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;BaseModel&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getCacheKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getFromDb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getCacheKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;geFromDb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™æ ·çš„ä»£ç å¸¦æ¥çš„é—®é¢˜æ˜¯ç¼“å­˜ç³»ç»Ÿå’Œæ•°æ®ä»£ç é«˜åº¦è€¦åˆï¼Œå¦‚æœéœ€è¦æ›´æ¢æˆ–è€…æ’¤é”€ç¼“å­˜ç³»ç»Ÿï¼Œä»£ç å¾ˆéš¾ä¿®æ”¹ï¼Œä¹Ÿä¸å¥½é¢„æµ‹é£é™©ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ç®€å•çš„å‡ æ­¥æ¥å®ç°éä¾µå…¥å¼ç¼“å­˜ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€æ­¥å…ˆæŠ½è±¡å‡ºæ¥å£&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;UserModelInterface&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç¬¬äºŒæ­¥UserModelå®ç° UserModelInterface&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UserModel&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;BaseModel&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;UserModelInterface&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getFromDb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç¬¬ä¸‰æ­¥ä½¿ç”¨è£…é¥°æ¨¡å¼å»ºç«‹UserModelCache&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UserModelCache&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;BaseModelCache&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;UserModelInterface&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;UserModel&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;parent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__METHOD__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;/**
* éœ€è¦ç¼“å­˜çš„æ•°æ®éƒ½å¯ä»¥é€šè¿‡
* è¿™ä¸ªç±»é‡Œæ¥å®ç°ï¼Œå¯ä»¥é€šè¿‡ UserModelInterface çº¦æŸéƒ½éœ€è¦å®ç°çš„æ–¹æ³•
* å¦‚æœä¸éœ€è¦ç¼“å­˜çš„æ–¹æ³•ï¼Œä¼šé€šè¿‡ BaseModelCache çš„ __call æ–¹æ³•æ‹¦æˆªï¼Œ
* å¹¶ä¸”ç©¿é€åˆ° UserModel çš„ç±»é‡Œé¢å»è°ƒç”¨ã€‚
*
* ä¸€ä¸ªä¸éœ€è¦cacheçš„æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ï¼š
* ä¾‹å¦‚è°ƒç”¨ UserModelCache-&amp;gt;getAll()æ–¹æ³•ï¼Œå› ä¸º UserModelCache æ²¡æœ‰è¯¥æ–¹æ³•ï¼Œ
* æ‰€ä»¥ä¼šå¯»æ‰¾çˆ¶ç±» BaseModelCache ï¼Œçˆ¶ç±»
* ä¹Ÿæ²¡æœ‰è¯¥æ–¹æ³•ï¼Œä¼šè¢« BaseModelCache çš„ __call æ‹¦æˆªï¼Œæœ€åèµ°åˆ° UserModel-&amp;gt;getAll()
* è¿™æ ·ï¼Œåªè¦åœ¨UserModel å®ç°è¿™ä¸ª getAll å°±å¯ä»¥äº†ã€‚
*
* éœ€è¦cacheçš„æ–¹æ³•è°ƒç”¨ï¼š
* è°ƒç”¨ getList ä¼šèµ°åˆ°çˆ¶ç±»çš„ cache æ–¹æ³•ï¼Œcache æ–¹æ³•æ ¹æ®ä¼ é€’å‚æ•°ç”Ÿæˆäº† cahce id, é€šè¿‡
* Cache è·å–æ•°æ®ï¼Œè·å–ä¸åˆ°æ•°æ®ï¼Œè¿˜ä¼šèµ° UserModel -&amp;gt; getList æ–¹æ³•ï¼Œè¿™æ ·å°±å®ç°äº†ç¼“å­˜åŠŸèƒ½ï¼Œ
* è€Œåœ¨ UserModel é‡Œé¢æ²¡æœ‰åµŒå…¥ä»»ä½•ä»£ç ã€‚
*
* å…³äºå¦‚æœçµæ´»å®ç”¨ cahce çš„é—®é¢˜ï¼Œç¨åä¼šä»‹ç»ã€‚
*/&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;BaseModelCache&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$model&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;BaseModel&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// é€šè¿‡ __call æ–¹æ³•æ¥ç©¿é€ UserModelCache ä¸éœ€è¦ç¼“å­˜æˆ–è€…æœªå®ç°çš„æ–¹æ³•ï¼Œè®© __call å»è°ƒç”¨&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// UserModel çš„æ–¹æ³•&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;call_user_func_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$expire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getCacheKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;CACHE_OPEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;call_user_func_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$expire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getCacheKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç¬¬å››æ­¥çµæ´»ä½¿ç”¨&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// å¦‚æœæ²¡æœ‰ä½¿ç”¨æ¡†æ¶æä¾›çš„ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œé‚£ä¹ˆå°±è¦è‡ªå·±æ‰‹åŠ¨å®Œæˆäº†ã€‚&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// ä¾‹å¦‚è°ƒç”¨ UserModel çš„ getList æ–¹æ³•&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UserController&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;UserModelInterface&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;UserModelCache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ç›´æ¥èµ° UserModel&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// $user = new UserModel();&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ç°åœ¨çš„å¾ˆå¤šæ¡†æ¶éƒ½æä¾›äº†ä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ç”¨èµ·æ¥æ›´æ–¹ä¾¿å¼ºå¤§ï¼Œå¯ä»¥è®©ç”¨æˆ·é€šè¿‡ç®€å•çš„é…ç½®&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// æ¥å®ç°æ³¨å…¥çš„å†…å®¹ï¼Œä¸‹é¢ç”¨ lumen å’Œ yii2 åšä¸¤ä¸ªç®€å•çš„è¯´æ˜&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç¬¬äº”éƒ¨ lumen å’Œ yii2 ä¾èµ–æ³¨å…¥&lt;/p&gt;

&lt;p&gt;é€šè¿‡ lumen çš„ ServiceProvider æ¥æä¾›ä¾èµ–æ³¨å…¥&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//
// å…·ä½“çš„è·¯å¾„å’Œåç§°ç©ºé—´æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µæ¥
//
$app-&amp;gt;when('App\Http\Controllers\UserController')
-&amp;gt;needs('App\Models\UserModelInterface')
-&amp;gt;give('App\Models\Cache\UserModelCache');
//-&amp;gt;give('App\Models\Cache\UserModel'); ä¸éœ€è¦ç¼“å­˜

// åœ¨ controller é‡Œé¢ç›´æ¥å°±è¢«æ³¨å…¥äº† UserModelCache
// å¦‚æœéœ€è¦å…¶ä»–çš„ç¼“å­˜ï¼Œåªéœ€è¦ä¿®æ”¹æ­¤å¤„çš„ give å°±è¡Œäº†ï¼Œè¿™æ ·å°±å®ç°äº†
// çµæ´»é…ç½®ï¼Œä¸éœ€è¦å¯¹åº•å±‚çš„ä»£ç è¿›è¡Œä¿®æ”¹
//
class UserController
{
function index(UserModelInterface $user)
{
$user-&amp;gt;getList();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;yii2 æ˜¯é€šè¿‡ ServiceLoader å’Œ DI å®¹å™¨æ¥å®ç°çš„ï¼Œæ¶‰åŠ Container ç›¸å…³çš„ç±»ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ yii2 çš„æ–‡æ¡£&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$container = new yii\di\Container();
$container-&amp;gt;set('UserModelInterface', 'UserModelCache');

// ä½¿ç”¨
$user = $container-&amp;gt;get('UserModelInterface');
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä»¥ä¸Šä»£éƒ½æ˜¯ä¸ºäº†æ¼”ç¤ºï¼Œå¹¶ä¸æ˜¯çœŸå®ä½¿ç”¨ç¯å¢ƒï¼Œå’ŒçœŸå®ç¯å¢ƒæœ‰å·®å¼‚ï¼Œè¯·è‡ªè¡Œè°ƒæ•´&lt;/p&gt;

&lt;p&gt;END.&lt;/p&gt;</content><author><name></name></author><summary type="html">æœ¬æ–‡çš„ç›®æ ‡ ç®€å•å‡ æ­¥ï¼Œè½»æ¾å®ç°éä¾µå…¥å¼ç¼“å­˜ã€‚</summary></entry><entry><title type="html">Yaf framework ç›¸å…³</title><link href="http://rust.love/2016/01/05/yaf_php_framework.html" rel="alternate" type="text/html" title="Yaf framework ç›¸å…³" /><published>2016-01-05T17:39:41+08:00</published><updated>2016-01-05T17:39:41+08:00</updated><id>http://rust.love/2016/01/05/yaf_php_framework</id><content type="html" xml:base="http://rust.love/2016/01/05/yaf_php_framework.html">&lt;h1 id=&quot;yaf-é¡¹ç›®éª¨æ¶&quot;&gt;Yaf é¡¹ç›®éª¨æ¶&lt;/h1&gt;

&lt;p&gt;åœ¨ yaf çš„æºç ç›®å½•ï¼Œé™„å¸¦äº†ä¸€ä¸ªå·¥å…· tools ç›®å½•ï¼Œ ä¸‹é¢æœ‰ä¸ª cg/yaf_cg å·¥å…·ï¼Œæ˜¯é€šè¿‡æ¨¡ç‰ˆç”Ÿæˆ yaf é¡¹ç›®éª¨æ¶çš„å·¥å…·ã€‚&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Usage:
./yaf_cg ApplicationName &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;ApplicationPath]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é¡¹ç›®ç›®å½•&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â”œâ”€â”€ application
â”‚Â Â  â”œâ”€â”€ Bootstrap.php
â”‚Â Â  â”œâ”€â”€ controllers
â”‚Â Â  â”œâ”€â”€ library
â”‚Â Â  â”œâ”€â”€ models
â”‚Â Â  â”œâ”€â”€ plugins
â”‚Â Â  â””â”€â”€ views
â”œâ”€â”€ conf
â”‚Â Â  â””â”€â”€ application.ini
â””â”€â”€ index.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;index.php ç¨‹åºçš„å…¥å£æ–‡ä»¶&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;application ä¸»è¦çš„åº”ç”¨ç¨‹åºä»£ç ç›®å½•ã€‚
2.1 å¯ä»¥é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;application.directory&lt;/code&gt;è¿™ä¸ªé…ç½®æ¥ä¿®æ”¹ã€‚
2.2 application ç›®å½•ä¸‹çš„ç›®å½•ï¼ˆcontrollersã€modelsã€pluginsã€viewsï¼‰æ˜¯é»˜è®¤çš„ä»£ç ç»“æ„ç›®å½•ï¼Œyaf ä¼šæ ¹æ®ç›¸å…³çš„ç±»åç§°ï¼Œå»ç›¸å…³ç›®å½•ä¸‹åŠ è½½ç›¸å…³çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ &lt;code class=&quot;highlighter-rouge&quot;&gt;IndexController extends Yaf\Controller_Abstract&lt;/code&gt; è¿™ä¸ªæ–‡ä»¶ï¼Œyaf å°±ä¼šåˆ° &lt;code class=&quot;highlighter-rouge&quot;&gt;controllers&lt;/code&gt; ç›®å½•ä¸‹æŸ¥æ‰¾ Index.phpã€ç±»&lt;code class=&quot;highlighter-rouge&quot;&gt;UserModel&lt;/code&gt;å°±ä¼šåˆ° models ç›®å½•ä¸‹æŸ¥æ‰¾ User.phpï¼ˆå¯ä»¥å®šåˆ¶æ–‡ä»¶åç¼€æˆ–å‰ç¼€æ¨¡å¼ï¼Œå¦‚ ModelUser å°±æ˜¯å‰ç¼€æ¨¡å¼ï¼‰ã€‚
2.3 é™¤äº† library ç›®å½•ä»¥å¤–ï¼Œå…¶å®ƒç›®å½•éƒ½æ˜¯åœ¨æ¡†æ¶ç¼–è¯‘çš„æ—¶å€™ç¡®å®šçš„ï¼Œlibrary ç›®å½•ä¸»è¦æ˜¯å­˜æ”¾ä¸€äº›æœ¬åœ°åº“æ–‡ä»¶ä¾‹å¦‚æˆ‘æœ‰ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;Helper_Html (åç§°ç©ºé—´æ¨¡å¼ Helper\Html)&lt;/code&gt;ç±»ï¼Œé€šè¿‡æ³¨å†Œæœ¬åœ°ç±»åç§°ç©ºé—´&lt;code class=&quot;highlighter-rouge&quot;&gt;Yaf_Loader::registerLocalNamespace(&quot;Helper&quot;)&lt;/code&gt;æ¥åŠ è½½ï¼Œæ–‡ä»¶çš„å­˜å‚¨ç»“æ„æ˜¯ &lt;code class=&quot;highlighter-rouge&quot;&gt;library/helper/Html.php&lt;/code&gt; éœ€è¦æ³¨æ„çš„å°±æ˜¯è¦å¼€å¯åç§°ç©ºé—´ï¼Œä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;namespace&lt;/code&gt;çš„ç±»åç§°å’Œä¸ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;namespace&lt;/code&gt;çš„ classname æœ‰äº›å·®å¼‚ã€‚
2.4 Bootstrap.php æ˜¯æ¡†æ¶çš„å¼•å¯¼ç±» (å¯ä»¥æ²¡æœ‰)ï¼Œç»§æ‰¿è‡ª &lt;code class=&quot;highlighter-rouge&quot;&gt;Yaf\Bootstrap_Abstract&lt;/code&gt;ï¼Œåœ¨ Application å¯¹è±¡åˆ›å»ºçš„æ—¶å€™å¯ä»¥è°ƒç”¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;$application-&amp;gt;bootstrap()-&amp;gt;run()&lt;/code&gt; è¿™æ ·ä¼šæ‰§è¡ŒBootstrapç±»é‡Œæ‰€æœ‰&lt;code class=&quot;highlighter-rouge&quot;&gt;_init&lt;/code&gt;å¼€å¤´çš„æ–¹æ³•ï¼Œä¸€èˆ¬ç”¨äºåˆå§‹åŒ–ä¸€äº›é…ç½®æˆ–è€…æ•°æ®æˆ–è€…åˆå§‹åŒ–pluginç­‰èµ„æºã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;conf æ˜¯é…ç½®æ–‡ä»¶ç›®å½•ï¼Œ ä¹Ÿæ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;yaf-å®Œæˆä¸€æ¬¡è¯·æ±‚çš„æµç¨‹å›¾&quot;&gt;Yaf å®Œæˆä¸€æ¬¡è¯·æ±‚çš„æµç¨‹å›¾&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/yaf_sequence.png&quot; alt=&quot;yafæµç¨‹å›¾&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;æµç¨‹è§£è¯»&quot;&gt;æµç¨‹è§£è¯»&lt;/h1&gt;

&lt;h2 id=&quot;indexphp-å…¥å£&quot;&gt;index.php å…¥å£&lt;/h2&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'APPLICATION_PATH'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;dirname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;__FILE__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$application&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Yaf\Application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;APPLICATION_PATH&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/conf/application.ini&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$application&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// æ‰§è¡Œå¼•å¯¼ç±»Bootstrap.php ç›¸å…³çš„å¼•å¯¼æ–¹æ³•&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;bootstrapphp-å¼•å¯¼ç±»&quot;&gt;Bootstrap.php å¼•å¯¼ç±»&lt;/h2&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
* æ‰€æœ‰çš„ _init å¼€å¤´çš„çš„æ–¹æ³•ï¼Œéƒ½ä¼šè¢«æ‰§è¡Œ
*/&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Bootstrap&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Yaf\Bootstrap_Abstract&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
* åˆå§‹åŒ–æœ¬åœ°ç±»åº“çš„åç§°ç©ºé—´ Biz Ns
* ä¾‹å¦‚æœ¬åœ°ç±»åº“ Biz_Test, Ns\Test æ”¾åœ¨libraryç›®å½•ä¸‹
* library/biz/Test.php
* library/ns/Test.php
*/&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_initRegisterLocalClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Yaf\Dispatcher&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$loader&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Yaf\Loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;registerLocalNamespace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Biz&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Ns&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;/**
* åˆå§‹åŒ–ä¸€äº›é…ç½®ä¿¡æ¯
*/&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_initConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$arrConfig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Yaf\Application&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Yaf\Registry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'config'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$arrConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_initPlugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Yaf\Dispatcher&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åˆå§‹åŒ–ä¸€äº›æ’ä»¶ï¼Œ æ’ä»¶æ–‡ä»¶å­˜æ”¾åœ¨ plugins ç›®å½•ï¼Œ&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// ç±»åå­—è§„åˆ™æ˜¯ XxxxPlugin æ”¾åœ¨ plugins ä¸‹çš„ Xxxx.php æ–‡ä»¶&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_initRoute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Yaf\Dispatcher&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// å¢åŠ ä¸€äº›è·¯ç”±è§„åˆ™&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// é»˜è®¤æ˜¯ Yaf_Route_Static&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// æ”¯æŒä»¥ä¸‹æ–¹å¼&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Yaf_Route_Simple&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Yaf_Route_Supervar&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Yaf_Route_Static&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Yaf_Route_Map&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Yaf_Route_Rewrite&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Yaf_Route_Regex&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;â€¦â€¦&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;æ’ä»¶-plugins&quot;&gt;æ’ä»¶ Plugins&lt;/h2&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªæ’ä»¶ Sample&lt;/p&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Sample.php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SamplePlugin&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Yaf\Plugin_Abstract&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ’ä»¶å®šä¹‰äº†6ä¸ª hook&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;routerStartup
routerShutdown
dispatchLoopStartup
preDispatch
postDispatch
dispatchLoopShutdown
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ’ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯å…ˆè¿›å…ˆè°ƒç”¨ã€‚&lt;/p&gt;

&lt;h2 id=&quot;è·¯ç”±è§„åˆ™-routes&quot;&gt;è·¯ç”±è§„åˆ™ routes&lt;/h2&gt;

&lt;p&gt;yaf æ”¯æŒå¤šç§è·¯ç”±è§„åˆ™ï¼Œé»˜è®¤é‡‡ç”¨äº†&lt;code class=&quot;highlighter-rouge&quot;&gt;Yaf_Route_Static&lt;/code&gt;æ–¹å¼ï¼Œæ”¯æŒä»¥ä¸‹æ–¹å¼&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Yaf_Route_Simple
Yaf_Route_Supervar
Yaf_Route_Static
Yaf_Route_Map
Yaf_Route_Rewrite
Yaf_Route_Regex
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è·¯ç”±è§„åˆ™å¯ä»¥é…ç½®åœ¨ application.ini é…ç½®æ–‡ä»¶å†…ï¼Œä¹Ÿå¯ä»¥åœ¨ç¨‹åºåˆå§‹åŒ–çš„æ—¶å€™åŠ¨æ€ç”Ÿæˆå¢åŠ ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡å®ç°&lt;code class=&quot;highlighter-rouge&quot;&gt;Route_Interface&lt;/code&gt;æ¥å£ï¼Œè‡ªå®šä¹‰è·¯ç”±è§„åˆ™ã€‚å…·ä½“å„ç§è·¯ç”±åè®®çš„å«ä¹‰å’Œä½¿ç”¨æ–¹å¼è§&lt;a href=&quot;http://www.laruence.com/manual/yaf.routes.html&quot;&gt;è·¯ç”±åè®®è¯¦è§£&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;è§†å›¾-views&quot;&gt;è§†å›¾ Views&lt;/h2&gt;
&lt;p&gt;yaf çš„è§†å›¾æ–‡ä»¶é»˜è®¤æ”¾åœ¨ views ç›®å½•ä¸‹ï¼Œé»˜è®¤æ–‡ä»¶åç¼€åç§° &lt;code class=&quot;highlighter-rouge&quot;&gt;.phtml&lt;/code&gt;ï¼Œview æ–‡ä»¶å°±æ˜¯ php æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ¨¡å—-modules-æ”¯æŒ&quot;&gt;æ¨¡å— modules æ”¯æŒ&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;yaf é»˜è®¤æ”¯æŒæ¨¡å—çš„ï¼Œåœ¨é»˜è®¤çš„è·¯ç”±æ¨¡å¼ä¸‹ï¼Œä¸€èˆ¬è¯·æ±‚çš„è·¯å¾„ä¸º &lt;code class=&quot;highlighter-rouge&quot;&gt;/index.php/Module/Controller/Action/p1/v1/p2/v2&lt;/code&gt; ï¼ˆé€šè¿‡ rewrite è§„åˆ™å»é™¤ index.phpï¼‰å°±æ˜¯ &lt;code class=&quot;highlighter-rouge&quot;&gt;/Module/Controller/Action/p1/v1/p2/v2&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¦‚æœä¸æŒ‡å®šé»˜è®¤çš„æ¨¡å—æ§åˆ¶å™¨å’Œactionï¼Œé‚£ä¹ˆè¿™ä¸‰ä¸ªå€¼é»˜è®¤ä¸º&lt;code class=&quot;highlighter-rouge&quot;&gt;Index&lt;/code&gt;ï¼Œè¯·æ±‚ &lt;code class=&quot;highlighter-rouge&quot;&gt;/index.php&lt;/code&gt; æ‰§è¡Œçš„è·¯ç”±è§„åˆ™å°±æ˜¯ &lt;code class=&quot;highlighter-rouge&quot;&gt;/Index/Index/Index&lt;/code&gt;ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¢åŠ ä¸€ä¸ªæ¨¡å— Test, éœ€è¦é…ç½® &lt;code class=&quot;highlighter-rouge&quot;&gt;application.modules=&quot;Index,Test&quot;&lt;/code&gt; ï¼Œä¸”åœ¨ applications ä¸‹å¢åŠ  modules/Test/controllers æ–‡ä»¶å¤¹ï¼Œè¿™æ · &lt;code class=&quot;highlighter-rouge&quot;&gt;/test/index/index&lt;/code&gt; å°±ä¼šæ‰§è¡Œ &lt;code class=&quot;highlighter-rouge&quot;&gt;modules/Test/controllers/Index.php&lt;/code&gt; æ–‡ä»¶çš„ &lt;code class=&quot;highlighter-rouge&quot;&gt;indexAction&lt;/code&gt; æ–¹æ³•&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¦‚æœåªæœ‰ä¸€ä¸ªé»˜è®¤ module ï¼Œé‚£ä¹ˆä¸éœ€è¦ modules æ–‡ä»¶å¤¹ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;å¼•å…¥å¤–éƒ¨åº“&quot;&gt;å¼•å…¥å¤–éƒ¨åº“&lt;/h2&gt;

&lt;h3 id=&quot;composer-æ–¹å¼&quot;&gt;composer æ–¹å¼&lt;/h3&gt;

&lt;p&gt;é€šè¿‡ composer å®‰è£…çš„ç¬¬ä¸‰æ–¹åº“éƒ½ä¼šå¸¦æœ‰autoload.php æ–‡ä»¶ï¼Œé‚£ä¹ˆæ ¹æ®å…·ä½“çš„æƒ…å†µå¯ä»¥åœ¨ index.php å…¥å£æ–‡ä»¶æˆ–è€… Bootstrap å¼•å¯¼ç±»å†…ï¼ŒåŠ è½½è¿™ä¸ª autoload.php æ–‡ä»¶æ¥ä½¿ç”¨å¤–éƒ¨ç±»ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// index.php&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'APPLICATION_PATH'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;dirname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;__FILE__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// å¼•å…¥ç¬¬ä¸‰æ–¹ç±»åº“&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;APPLICATION_PATH&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/vendor/autoload.php'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$application&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Yaf\Application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;APPLICATION_PATH&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/conf/application.ini&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$application&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;åœ¨&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Controller&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;?&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;GuzzleHttp\Client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IndexController&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Yaf\Controller_Abstract&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;indexAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$httpClient&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;var_dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$httpClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å…¨å±€åº“-yaflibrary&quot;&gt;å…¨å±€åº“ yaf.library&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªé…ç½®é€‰é¡¹æ˜¯é…ç½®åœ¨ php.ini å†…çš„ï¼Œä¾‹å¦‚å¤šä¸ªé¡¹ç›®éœ€è¦å…¬ç”¨ä¸€äº›å…¨å±€çš„åº“æ–‡ä»¶ï¼Œé‚£ä¹ˆé€šè¿‡æŒ‡å®šè¯¥è·¯å¾„ï¼Œæ¥è®©ä¸åŒçš„é¡¹ç›®ä¹‹é—´å…±äº«åŒä¸€ä¸ªåº“æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;h3 id=&quot;è‡ªå®šä¹‰-class-loader&quot;&gt;è‡ªå®šä¹‰ class loader&lt;/h3&gt;

&lt;p&gt;å¦‚æœä½ çš„åº“æ–‡ä»¶å‘½åæ–¹å¼ç­‰ä¸ç¬¦åˆ yaf çš„è‡ªåŠ¨åŠ è½½é£æ ¼ï¼Œé‚£ä¹ˆå¯ä»¥è‡ªå®šä¹‰ auto æ–¹å¼ï¼Œå¯ä»¥åœ¨ Bootstrap å¼•å¯¼ç±»åŠ è½½çš„æ—¶å€™è¿›è¡Œæ³¨å†Œã€‚&lt;/p&gt;

&lt;h1 id=&quot;ä¸»è¦ç±»åº“ä»£ç è§£æ&quot;&gt;ä¸»è¦ç±»åº“ä»£ç è§£æ&lt;/h1&gt;

&lt;h3 id=&quot;yaf_loaderautoload&quot;&gt;Yaf_Loader::autoload&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªæ˜¯ Yaf è‡ªåŠ¨åŠ è½½ç±»çš„å‡½æ•°ï¼Œ æ•´ä¸ªåŠ è½½è¡Œä¸ºä¼šå—åˆ° &lt;code class=&quot;highlighter-rouge&quot;&gt;yaf.use_spl_autoload&lt;/code&gt; è¿™ä¸ªé…ç½®çš„å½±å“ï¼Œå¼€å¯çš„æƒ…å†µä¸‹, Yafåœ¨åŠ è½½ä¸æˆåŠŸçš„æƒ…å†µä¸‹, ä¼šç»§ç»­è®©PHPçš„è‡ªåŠ¨åŠ è½½å‡½æ•°åŠ è½½ï¼Œå¦åˆ™ä¼šè§¦å‘ E_WARNING æˆ–è€… E_STRICT ä¸‹é¢æ˜¯ç›¸å…³éƒ¨åˆ†æºç ï¼š&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yaf_internal_autoload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file_name_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;directory&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lc_classname&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zend_str_tolower_dup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;origin_classname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;class_name_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zend_hash_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class_table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lc_classname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;class_name_len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;â€¦â€¦&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;efree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lc_classname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;php_error_docref&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;E_STRICT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Could not find class %s in %s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;class_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;directory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;php_error_docref&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;E_WARNING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Failed opening script %s: %s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;directory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strerror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;yaf_loaderautoload-æµç¨‹å›¾&quot;&gt;Yaf_Loader::autoload æµç¨‹å›¾&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/autoload.png&quot; alt=&quot;Yaf_Loader::autoload æµç¨‹å›¾&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å°† \ å¤„ç†ä¸º _ ä¸»è¦æ˜¯ä¸ºäº†è®©ç±»åæ— è®ºæ˜¯åç§°ç©ºé—´æ¨¡å¼ï¼Œè¿˜æ˜¯ _ æ¨¡å¼ï¼Œéƒ½å…¼å®¹ã€‚&lt;/li&gt;
  &lt;li&gt;ç¡®å®šæ–‡ä»¶ç›®å½•ä½ç½®ï¼š ä¸»è¦æ˜¯æ ¹æ®ç³»ç»Ÿçš„å‡ ä¸ªå›ºå®šç›®å½•æ¥åˆ¤æ–­æ–‡ä»¶çš„ä½ç½® controllersã€modelsã€pluginsã€library ç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;yaf_applicationbootstrap&quot;&gt;Yaf_Application::bootstrap&lt;/h3&gt;

&lt;p&gt;é™¤äº† autoload æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ä»¥å¤–ï¼Œbootstrap ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼Œå› ä¸ºç»å¸¸ä¼šæœ‰å¾ˆå¤šæ•°æ®åˆå§‹åŒ–ç­‰ä»£ç éœ€è¦åœ¨è¿™ä¸ªé˜¶æ®µæ¥åšï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;bootstrap()&lt;/code&gt;æ–¹æ³•çš„ä¸»è¦å·¥ä½œå°±æ˜¯å¾ªç¯éå† &lt;code class=&quot;highlighter-rouge&quot;&gt;Bootstrap extends Yaf_Bootstrap&lt;/code&gt; è¿™ä¸ªç±»çš„æ‰€æœ‰ä»¥ _init å¼€å¤´çš„æ–¹æ³•ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;methods&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;function_table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zend_hash_internal_pointer_reset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;methods&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;zend_hash_has_more_elements&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;methods&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SUCCESS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;zend_hash_move_forward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;methods&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;uint&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ulong&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;zend_hash_get_current_key_ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;methods&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/* cann't use ZEND_STRL in strncasecmp, it cause a compile failed in VS2009 */&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/* YAF_BOOTSTRAP_INITFUNC_PREFIX å°±æ˜¯ _init */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strncasecmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YAF_BOOTSTRAP_INITFUNC_PREFIX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YAF_BOOTSTRAP_INITFUNC_PREFIX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;zend_call_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/** an uncaught exception threw in function call */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;zval_ptr_dtor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;RETURN_FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;yaf_dispatcher&quot;&gt;Yaf_Dispatcher&lt;/h3&gt;

&lt;p&gt;Yaf_Dispatcher æ˜¯ä¸ªéå¸¸é‡è¦çš„çš„ç±»ï¼ŒåŸºæœ¬è´¯ç©¿äº†æ•´ä¸ªå¼€å‘è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ plugin çš„æ³¨å†Œå’Œè°ƒç”¨ï¼Œéƒ½å’Œ Yaf_Dispatcher è¿™ä¸ªç±»å¯†åˆ‡ç›¸å…³ã€‚æ³¨å†Œç±»çš„ä»£ç éå¸¸ç®€å•&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;PHP_METHOD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yaf_dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;registerPlugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;zval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;yaf_dispatcher_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getThis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zend_parse_parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ZEND_NUM_ARGS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;z&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FAILURE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Z_TYPE_P&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IS_OBJECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;instanceof_function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Z_OBJCE_P&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yaf_plugin_ce&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;php_error_docref&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;E_WARNING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Expect a %s instance&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yaf_plugin_ce&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;RETURN_FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;plugins&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zend_read_property&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yaf_dispatcher_ce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ZEND_STRL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YAF_DISPATCHER_PROPERTY_NAME_PLUGINS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Z_ADDREF_P&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;add_next_index_zval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;RETVAL_ZVAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è°ƒç”¨æ’ä»¶ä»¥åŠæ’ä»¶ä¸­çš„ 6 ä¸ª hook çš„ä»£ç ä¸»è¦é›†ä¸­åœ¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;yaf_response_t * yaf_dispatcher_dispatch(yaf_dispatcher_t *dispatcher TSRMLS_DC)&lt;/code&gt; æ–¹æ³•å†…ï¼Œä¸»è¦æ˜¯ Yaf_Application::run() çš„æ—¶å€™ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/** ä»£è¡¨äº† hook çš„ 6 ä¸ªé˜¶æ®µ
YAF_PLUGIN_HOOK_ROUTESTARTUP
YAF_PLUGIN_HOOK_ROUTESHUTDOWN
YAF_PLUGIN_HOOK_LOOPSTARTUP
YAF_PLUGIN_HOOK_PREDISPATCH
YAF_PLUGIN_HOOK_POSTDISPATCH
YAF_PLUGIN_HOOK_LOOPSHUTDOWN
*/&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yaf_request_is_routed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HOOK_ROUTESTARTUP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_EXCEPTION_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yaf_dispatcher_route&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;yaf_trigger_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YAF_ERR_ROUTE_FAILED&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Routing request failed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_EXCEPTION_HANDLE_NORET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;zval_ptr_dtor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;yaf_dispatcher_fix_default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HOOK_ROUTESHUTDOWN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_EXCEPTION_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yaf_request_set_routed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;yaf_dispatcher_fix_default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HOOK_LOOPSTARTUP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_EXCEPTION_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;view&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yaf_dispatcher_init_view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HOOK_PREDISPATCH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_EXCEPTION_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yaf_dispatcher_handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;view&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_EXCEPTION_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;zval_ptr_dtor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;yaf_dispatcher_fix_default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HOOK_POSTDISPATCH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_EXCEPTION_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nesting&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yaf_request_is_dispatched&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YAF_PLUGIN_HOOK_LOOPSHUTDOWN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_EXCEPTION_HANDLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nesting&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yaf_request_is_dispatched&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;yaf_trigger_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YAF_ERR_DISPATCH_FAILED&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TSRMLS_CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;The max dispatch nesting %ld was reached&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YAF_G&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;forward_limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;YAF_EXCEPTION_HANDLE_NORET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;zval_ptr_dtor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä»¥ä¸Šå°±æ˜¯å‡ ä¸ªä¸»è¦çš„ç±»å’Œç›¸å…³ä»£ç æµç¨‹ã€‚&lt;/p&gt;</content><author><name></name></author><summary type="html">Yaf é¡¹ç›®éª¨æ¶</summary></entry><entry><title type="html">MySQL5.6 éƒ¨åˆ†ç‰¹æ€§ä»‹ç»</title><link href="http://rust.love/2015/12/22/mysql-56-some-feature.html" rel="alternate" type="text/html" title="MySQL5.6 éƒ¨åˆ†ç‰¹æ€§ä»‹ç»" /><published>2015-12-22T17:25:00+08:00</published><updated>2015-12-22T17:25:00+08:00</updated><id>http://rust.love/2015/12/22/mysql-56-some-feature</id><content type="html" xml:base="http://rust.love/2015/12/22/mysql-56-some-feature.html">&lt;h3 id=&quot;memcached&quot;&gt;Memcached&lt;/h3&gt;

&lt;p&gt;ç™»é™† MySQL æŸ¥çœ‹æ’ä»¶ç›®å½•ï¼Œå®‰è£…å¯¹åº”çš„é…ç½®æ•°æ®è¡¨&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -hlocalhost -uroot -p
mysql &amp;gt; SELECT @@plugin_dir; // æŸ¥çœ‹æ’ä»¶ç›®å½•

// å¯¼å…¥ memcache ç›¸å…³çš„è¡¨
mysql &amp;gt; SOURCE /usr/local/mysql/share/innodb_memcached_config.sql
Query OK, 1 row affected (0.00 sec)

Database changed
Query OK, 0 rows affected (0.02 sec)


// å¤šäº†ä¸€ä¸ª innodb_memcache åº“
mysql&amp;gt; show databases;
+------------------------+
| Database               |
+------------------------+
| information_schema     |
| innodb_memcache        |
| test                   |
+------------------------+
â€¦â€¦
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ¿€æ´»å’Œå¸è½½æ’ä»¶&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; INSTALL PLUGIN daemon_memcached soname &quot;libmemcached.so&quot;;  //  æ¿€æ´»æ’ä»¶
mysql&amp;gt; UNINSTALL PLUGIN daemon_memcached; // å¸è½½æ’ä»¶
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€šè¿‡ MySQL æŸ¥çœ‹é…ç½®ä¿¡æ¯&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;myssql&amp;gt; SHOW VARIABLES LIKE '%memcached%';

daemon_memcached_enable_binlog  OFF
daemon_memcached_engine_lib_name    innodb_engine.so
daemon_memcached_engine_lib_path
daemon_memcached_option
daemon_memcached_r_batch_size   1
daemon_memcached_w_batch_size   1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æŸ¥çœ‹ Memcached&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;shell &amp;gt; telnet localhost 11211
stats

Trying ::1...
Connected to localhost.
Escape character is '^]'.
stats
STAT pid 94
STAT uptime 317
STAT time 1450766105
STAT version 5.6.27
STAT libevent 5.6.27
STAT pointer_size 64
STAT rusage_user 16.726572
STAT rusage_system 18.890886
â€¦â€¦

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;innodb_memcache åº“çš„è¯¦ç»†ä¿¡æ¯&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; use innodb_memcache;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&amp;gt; show tables;
+---------------------------+
| Tables_in_innodb_memcache |
+---------------------------+
| cache_policies            |
| config_options            |
| containers                |
+---------------------------+
3 rows in set (0.00 sec)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;cache_policies ç¼“å­˜ç­–ç•¥&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;innodb_only åªä½¿ç”¨InnoDBä½œä¸ºæ•°æ®å­˜å‚¨&lt;/li&gt;
  &lt;li&gt;cache-only  åªä½¿ç”¨ä¼ ç»Ÿçš„Memcachedå¼•æ“ä½œä¸ºåç«¯å­˜å‚¨&lt;/li&gt;
  &lt;li&gt;caching     äºŒè€…çš†ä½¿ç”¨ï¼Œå¦‚æœåœ¨Memcachedé‡Œæ‰¾ä¸åˆ°ï¼Œå°±æŸ¥è¯¢InnoDB&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; select * from cache_policies \G
*************************** 1. row ***************************
policy_name: cache_policy
get_policy: innodb_only
set_policy: innodb_only
delete_policy: innodb_only
flush_policy: innodb_only
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;config_options é…ç½®å‚æ•°&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; select * from config_options \G
*************************** 1. row ***************************
name: separator   // Memcachedåªè¯†åˆ«å•å€¼ï¼Œä½¿ç”¨æ­¤åˆ†éš”ç¬¦ï¼ˆ|ï¼‰æ¥è¿æ¥å¤šä¸ªå­—æ®µçš„å€¼ï¼Œéœ€è¦æ³¨æ„å½“å€¼å†…å«æœ‰`|`çš„æ—¶å€™ï¼Œä¼šå¸¦æ¥é”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ separator
value: |
*************************** 2. row ***************************
name: table_map_delimiter // é€šè¿‡æ­¤åˆ†éš”ç¬¦ï¼ˆ.ï¼‰æ¥ç¡®è®¤è¡¨å’Œé”®ï¼Œå¦‚ï¼š@@table.keyã€‚
value: .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœé€šè¿‡ Memcached åè®®æ¥è®¿é—®æ•°æ®è¡¨ï¼Œè¿˜éœ€è¦åœ¨ containers è¡¨é‡Œåšä¸€äº›é…ç½® &lt;code class=&quot;highlighter-rouge&quot;&gt;demo_test&lt;/code&gt; æ˜¯å¼€å§‹ SOURCE å¯¼å…¥ &lt;code class=&quot;highlighter-rouge&quot;&gt;innodb_memcached_config.sql&lt;/code&gt; æ–‡ä»¶çš„æ—¶å€™ç”Ÿæˆçš„ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; SELECT * FROM containers\G
*************************** 1. row ***************************
name: aaa
db_schema: test
db_table: demo_test
key_columns: c1
value_columns: c2
flags: c3
cas_column: c4
expire_time_column: c5
unique_idx_name_on_key: PRIMARY
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æŸ¥çœ‹ demo_test è¡¨ç»“æ„&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; DESC test.demo_test;
+-------+---------------------+------+-----+---------+-------+
| Field | Type                | Null | Key | Default | Extra |
+-------+---------------------+------+-----+---------+-------+
| c1    | varchar(32)         | NO   | PRI |         |       |
| c2    | varchar(1024)       | YES  |     | NULL    |       |
| c3    | int(11)             | YES  |     | NULL    |       |
| c4    | bigint(20) unsigned | YES  |     | NULL    |       |
| c5    | int(11)             | YES  |     | NULL    |       |
+-------+---------------------+------+-----+---------+-------+
5 rows in set (0.01 sec)

mysql&amp;gt; select * from test.demo_test;
+----+--------------+------+------+------+
| c1 | c2           | c3   | c4   | c5   |
+----+--------------+------+------+------+
| AA | HELLO, HELLO |    8 |    0 |    0 |
+----+--------------+------+------+------+
1 row in set (0.00 sec)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€šè¿‡ Memcached åè®®è·å¾—æ•°æ®&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;shell&amp;gt; telnet localhost 11211
Trying ::1...
Connected to localhost.
Escape character is '^]'.
get @@aaa.AA   // aaa å°±æ˜¯ containers è¡¨çš„ name å­—æ®µçš„å€¼ï¼Œç›¸å½“äº `db_schema.db_table`
VALUE @@aaa.AA 8 12 // VALUE &amp;lt;key&amp;gt; &amp;lt;flags&amp;gt; &amp;lt;bytes&amp;gt;
HELLO, HELLO
END
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€šè¿‡ php æ¥è®¿é—®è¿™ä¸ªæ•°æ®&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$mc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Memcache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$mc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'127.0.0.1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11211&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;var_dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$mc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'@@aaa.AA'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// è¿™é‡Œéœ€è¦æ³¨æ„å¦‚æœ `containers` æœ‰å¤šè¡Œæ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨è¡¨å‰ç¼€ `@@name.` å¦‚æœä¸ä½¿ç”¨è¡¨åï¼Œé‚£ä¹ˆä¼šé»˜è®¤ä¼šæŒ‰ç…§è¡¨åçš„å­—æ¯é¡ºåºï¼Œå–ç¬¬ä¸€ä¸ªã€‚å¦‚æœ `containers` åªæœ‰ä¸€è¡Œæ•°æ® name ä¸º `aaa`ï¼Œé‚£ä¹ˆé»˜è®¤ `get('AA')` ä¹Ÿæ˜¯ä¼šå– `@aaa.AA`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ddl-online&quot;&gt;DDL online&lt;/h3&gt;

&lt;p&gt;ä¿®æ”¹è¡¨ç»“æ„æ˜¯æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸é‡åˆ°çš„äº‹æƒ…ï¼Œæ—©æœŸ MySQL ç‰ˆæœ¬åœ¨ä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™ï¼Œä¸»è¦é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;åˆ›å»ºä¸´æ—¶è¡¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;tmp&lt;/code&gt; ï¼Œè¯¥è¡¨ä¸åŸè¡¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;table&lt;/code&gt; ç›¸ä¼¼&lt;/li&gt;
  &lt;li&gt;å°†&lt;code class=&quot;highlighter-rouge&quot;&gt;table&lt;/code&gt;æ•°æ®å¤åˆ¶åˆ° &lt;code class=&quot;highlighter-rouge&quot;&gt;tmp&lt;/code&gt;ï¼Œ&lt;/li&gt;
  &lt;li&gt;åˆ é™¤åŸæœ‰è¡¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;table&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;rename tmp to table
å¦‚æœæ•°æ®é‡éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œæ•´ä¸ªè¡¨è¢«åŠ å…±äº«é”ï¼ŒåŸºæœ¬å°±ä¸èƒ½æä¾›æœåŠ¡äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ MySQL5.6 ä¸­ï¼Œè¿™ä¸ªæ“ä½œæœ‰äº†æ”¹å–„ï¼Œåœ¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;ALERT TABLE&lt;/code&gt; è¯­æ³•ä¸Šï¼Œå¢åŠ äº† &lt;code class=&quot;highlighter-rouge&quot;&gt;| ALGORITHM [=] {DEFAULT|INPLACE|COPY}&lt;/code&gt; é€‰é¡¹ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š &lt;code class=&quot;highlighter-rouge&quot;&gt;ALGORITHM&lt;/code&gt; ï¼ŒMySQL ä¼šæ ¹æ®æ”¯æŒçš„ç®—æ³•ï¼Œè‡ªåŠ¨é€‰æ‹©ï¼Œè€Œ &lt;code class=&quot;highlighter-rouge&quot;&gt;INPLACE&lt;/code&gt; ä¼šä¼˜å…ˆè¢«é€‰æ‹©ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¿®æ”¹è¡¨çš„æ—¶å€™ä¾ç„¶å¯ä»¥æä¾›æœåŠ¡ã€‚æœ‰äº› Online DDL æ˜¯ä¸æ”¯æŒçš„ï¼Œæœ‰äº›æ˜¯æœ‰ä¾èµ–æ¡ä»¶çš„ï¼ŒMySQL å®˜æ–¹æ˜ç¡®çš„åˆ—å‡ºäº†ä¸€ä¸ªè¡¨æ ¼ &lt;a href=&quot;https://dev.mysql.com/doc/refman/5.6/en/innodb-create-index-overview.html&quot;&gt;Online DDL æ“ä½œæ€»ç»“&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;mysql-å¤åˆ¶çš„æ–°ç‰¹æ€§&quot;&gt;MySQL å¤åˆ¶çš„æ–°ç‰¹æ€§&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;å¤šçº¿ç¨‹å¤åˆ¶ ç”±äºæ•°æ®åº“çš„ä¸»ä»æ¶æ„ï¼Œä»¥å‰çš„MySQLç‰ˆæœ¬ä¸»åº“å¤šçº¿ç¨‹å†™å…¥ï¼Œä¸ºäº†ä¿è¯&lt;code class=&quot;highlighter-rouge&quot;&gt;é¡ºåº&lt;/code&gt;ä»åº“æ˜¯å•çº¿ç¨‹è¯»å–ï¼Œç°åœ¨çš„å¤šçº¿ç¨‹å¤åˆ¶æ˜¯ä¸ºæ¯ä¸ªæ•°æ®åº“å¼€å¯äº†ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼ˆsql threadï¼‰ï¼Œæ‰€ä»¥å¦‚æœè¦ä½¿ç”¨å¤šçº¿ç¨‹å¤åˆ¶ç‰¹æ€§ï¼Œéœ€è¦æŠŠåº“æ‹†åˆ†æˆå¤šä¸ªï¼Œå¦‚æœè¿˜æ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤šçº¿ç¨‹å¤åˆ¶ç‰¹æ€§æ— æ•ˆã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;GTID å…¨å±€äº‹åŠ¡IDï¼ˆglobal transaction identifierï¼‰ï¼ŒGTID æ˜¯äº‹åŠ¡æäº¤æ—¶åˆ›å»ºåˆ†é…çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ‰€æœ‰äº‹åŠ¡å‡ä¸ GTID ä¸€ä¸€æ˜ å°„ã€‚ä»¥å‰å¦‚æœä¸»ä»å¤åˆ¶æ–­äº†ï¼Œéœ€è¦äººå·¥å»æ‰¾åˆ°æ–­ç‚¹ï¼Œé‡æ–°å¼€å§‹ï¼Œè€Œ GTID çš„å¼•å…¥å¯ä»¥è‡ªåŠ¨å¯»æ‰¾åŒæ­¥ç‚¹ï¼Œè‡ªåŠ¨å®Œæˆå¤åˆ¶ï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºäº Row å¤åˆ¶åªä¿å­˜æ”¹å˜çš„åˆ—ï¼Œé™ä½ç¡¬ç›˜ã€ç½‘ç»œã€å†…å­˜ç­‰æ¶ˆè€—ã€‚&lt;/li&gt;
  &lt;li&gt;æ”¯æŒæŠŠ Master å’Œ Slave çš„ç›¸å…³ä¿¡æ¯è®°å½•åœ¨è¡¨ä¸­ï¼ŒåŸæ¥æ˜¯è®°å½•åœ¨æ–‡ä»¶é‡Œï¼Œè®°å½•åœ¨è¡¨é‡Œï¼Œå¢å¼ºå¯ç”¨æ€§ã€‚&lt;/li&gt;
  &lt;li&gt;æ”¯æŒå»¶æ—¶å¤åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;GTID çš„æ ¼å¼ç±»ä¼¼ server_uuid:id&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; select @@server_uuid;
+--------------------------------------+
| @@server_uuid                        |
+--------------------------------------+
| fbf78286-701a-11e5-a88b-5b1557785233 |
+--------------------------------------+
1 row in set (0.00 sec)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¯¥æ•°æ®è¢«å†™åœ¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;DATADIR (/usr/local/mysql/data/auto.cnf)&lt;/code&gt; æ–‡ä»¶ä¸­ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨çš„æ—¶å€™ç”± &lt;code class=&quot;highlighter-rouge&quot;&gt;generate_server_uuid&lt;/code&gt; å‡½æ•°ç”Ÿæˆã€‚
id æ˜¯äº‹åŠ¡ç¼–å·ï¼Œ server_uuid:id å…±åŒç»„æˆäº†äº‹åŠ¡çš„å”¯ä¸€ IDï¼Œç”¨æ¥æ ‡ç¤ºä¸€ä¸ªäº‹åŠ¡ã€‚
GTID å¤åˆ¶æœ‰ç€ä¸¥æ ¼çš„é™åˆ¶ï¼ŒGTID å®ä¾‹å’Œé GTID å®ä¾‹æ˜¯ä¸èƒ½è¿›è¡Œå¤åˆ¶çš„ã€‚
&lt;a href=&quot;http://dev.mysql.com/doc/refman/5.6/en/replication-gtids.html&quot;&gt;GTID å®˜æ–¹æ–‡æ¡£&lt;/a&gt; , &lt;a href=&quot;http://mysql.taobao.org/index.php?title=MySQL%E5%86%85%E6%A0%B8%E6%9C%88%E6%8A%A5_2014.09&amp;amp;oldid=848&quot;&gt;MySQL å†…æ ¸æœˆæŠ¥å‚è€ƒ&lt;/a&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">Memcached</summary></entry></feed>