<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>架构拆解之什么是 CDC（一周学习报-第2期） | Rust.Love</title>
<meta name="generator" content="Jekyll v3.7.2" />
<meta property="og:title" content="架构拆解之什么是 CDC（一周学习报-第2期）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="背景" />
<meta property="og:description" content="背景" />
<link rel="canonical" href="http://rust.love/cdc/mysql/arch/2018/02/09/cdc.html" />
<meta property="og:url" content="http://rust.love/cdc/mysql/arch/2018/02/09/cdc.html" />
<meta property="og:site_name" content="Rust.Love" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-02-09T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"架构拆解之什么是 CDC（一周学习报-第2期）","dateModified":"2018-02-09T00:00:00+08:00","url":"http://rust.love/cdc/mysql/arch/2018/02/09/cdc.html","datePublished":"2018-02-09T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://rust.love/cdc/mysql/arch/2018/02/09/cdc.html"},"description":"背景","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/main.css">
  <link type="application/atom+xml" rel="alternate" href="http://rust.love/feed.xml" title="Rust.Love" />
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" rel="author" href="/">Rust.Love</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">架构拆解之什么是 CDC（一周学习报-第2期）</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-02-09T00:00:00+08:00" itemprop="datePublished">
        
        Feb 9, 2018
      </time>
      </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="背景">背景</h2>

<p>在我们的整个架构体系中，我们大量的使用了 CDC，很多同学开始不太清楚，不知道 CDC 是什么，以为 CDC 是一个具体的软件，其实 CDC 是一个统称，就像 Office 代表的是一组办公软件，而 CDC 也是各种不同名字具有 CDC 功能的软件的统称，所以简单介绍下关于 CDC 的内容。文中 CDC 主要是和数据库、MySQL 相关的内容，并不具有广泛的意义。</p>

<h2 id="本期目标">本期目标</h2>

<ul>
  <li>了解什么是 CDC</li>
  <li>各种 CDC</li>
  <li>CDC 的一些使用场景和一些想象</li>
  <li>如何自己实现一个 CDC 软件</li>
</ul>

<h3 id="什么是-cdc">什么是 CDC</h3>

<p>CDC 全称 Change Data Capture，下面是来自<a href="https://en.wikipedia.org/wiki/Change_data_capture">维基百科</a>的一段说明：</p>

<blockquote>
  <p>In databases, change data capture (CDC) is a set of software design patterns used to determine (and track) the data that has changed so that action can be taken using the changed data. Also, Change data capture (CDC) is an approach to data integration that is based on the identification, capture and delivery of the changes made to enterprise data sources.
CDC solutions occur most often in data-warehouse environments since capturing and preserving the state of data across time is one of the core functions of a data warehouse, but CDC can be utilized in any database or data repository system.</p>
</blockquote>

<p>简单来说 CDC 就是记录数据变化的一个工具软件，它可以捕捉每一次的数据变化，我们使用的是阿里开源的 <a href="https://github.com/alibaba/canal">canal</a>，看下下面的这个图（来自 canal 介绍），基本就理解 CDC 的工作原理了，更详细的可以点开 <a href="https://github.com/alibaba/canal">canal</a> 链接，有更多的介绍。
<img src="/assets/images/canal.jpeg" alt="canal 工作原理" title="canal 工作原理" /></p>

<h3 id="各种-cdc">各种 CDC</h3>

<p>因为 CDC 软件繁多，我没有一一安装去实验，所以列举几个，供大家参考，更多的大家可以看<a href="https://github.com/wushujames/mysql-cdc-projects/wiki">这里</a>。</p>

<table>
  <tbody>
    <tr>
      <td>名称&amp;站点</td>
      <td>描述</td>
    </tr>
    <tr>
      <td><a href="https://github.com/alibaba/canal">canal</a></td>
      <td>阿里巴巴出品，很多中文文档，比较成熟 github star &gt; 4k fork &gt; 1700 多，Java 语言开发，有配套工具链。</td>
    </tr>
    <tr>
      <td><a href="https://github.com/linkedin/databus">databus</a></td>
      <td>star&gt;1800,fork&gt;400, 大厂出品，还是值得信赖的，Java 语言实现</td>
    </tr>
    <tr>
      <td><a href="https://github.com/JarvusInnovations/lapidus">lapidus</a></td>
      <td>Nodejs 实现的 star 76 fork 10</td>
    </tr>
    <tr>
      <td><a href="https://github.com/mardambey/mypipe">mypipe</a></td>
      <td>star&gt;300 fork&gt;50 Scala 实现的</td>
    </tr>
    <tr>
      <td><a href="https://github.com/siddontang/go-mysql-elasticsearch">go-mysql-elasticsearch</a></td>
      <td>star &gt; 1k fork &gt; 250 Golang</td>
    </tr>
    <tr>
      <td><a href="https://github.com/krowinski/php-mysql-replication">php-mysql-replication</a></td>
      <td>PHP 的，哈哈哈</td>
    </tr>
    <tr>
      <td><a href="https://github.com/noplay/python-mysql-replication">python-mysql-replication</a></td>
      <td>Python 的</td>
    </tr>
  </tbody>
</table>

<h3 id="cdc-使用场景和-cdc-在我们架构中的应用">CDC 使用场景和 CDC 在我们架构中的应用</h3>

<p>CDC 的应用场景就像它的名字一样，捕捉那些变化的数据，下面简单说几个具体的例子：</p>
<ul>
  <li>根据我们的业务，用户报名后会有一些列的数据变化，录取、待面试、拒绝等。</li>
  <li>电商中的订单状态变</li>
  <li>数据库数据变更更新检索</li>
  <li>……</li>
</ul>

<p>上面列觉的这几个例子，都会涉及到数据变更时，触发一些列的业务操作，直接通过应用程序代码进行异步的事件分发也是可以实现的，代码也可以做到不嵌入业务，但是多业务在共享数据的时候，也会存在一些问题，每个业务方都要去实现监听数据变化的代码。而采用 CDC 进行数据分发，是比较好的实现方式，通过 CDC 统一分发，业务方只关心业务逻辑，不用去写大量代码来做异步实现数据监听接收，下面是我理解的一个基于 CDC 和 Queue 来做的数据分发和共享平台的架构。</p>

<p><img src="/assets/images/cdc_queue_share_data.jpeg" alt="CDC Queue Dispatcher Data" /></p>

<p>通过上面的这套体系，MySQL 通过 CDC 把表变化的数据分发出来，存入相应的共享队列，每个想要使用该数据的的业务方，都可以通过去订阅这份数据来完成自己的业务功能，在代码上基本是完全分离了数据采集的工作。在这里需要注意的是<strong><em>数据是单向流向业务方的，所以在数据使用上一定要切合实际的业务功能</em></strong>。</p>

<p>目前我们的架构中，只是部分使用了这样的功能，且比较零散，没有从全局上面统筹数据分发，我们应用最多的是数据库数据变化时，更新检索。</p>

<h3 id="如何实现一个-cdc">如何实现一个 CDC？</h3>

<p>MySQL 的一些 CDC 软件就是实现了 <a href="https://dev.mysql.com/doc/internals/en/replication-protocol.html">MySQL-replication</a> 协议的 Slave 库，只是本身并不存储数据，做一些数据解析和分发功能。文中列举了各种语言的实现，并且都有链接地址，大家可以自行部署去玩了。</p>

<p>PS: 本来要自己实现一下发现有 PHP 版本了，😂，大家可以自己查看上面列出来的 PHP 的实现，一个简单的<a href="https://github.com/outman/weekly/tree/master/02">示例代码</a>。</p>

  </div>

  

  <a class="u-url" href="/cdc/mysql/arch/2018/02/09/cdc.html" hidden></a>
</article>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Rust.Love</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            
              Rust.Love
            
            </li>
            
            <li><a class="u-email" href="mailto:pochonleeATgmail.com">pochonleeATgmail.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
  
  
  
  <li><a href="https://github.com/outman"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">outman</span></a></li>
  
  
  
  <li><a href="https://www.twitter.com/pochonlee"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">pochonlee</span></a></li>
  
  
  
</ul>

      </div>

      <div class="footer-col footer-col-3">
        <p>Freedom &amp; Responsibility.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
